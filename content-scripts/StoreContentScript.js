/*! For license information please see StoreContentScript.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};t.r(e),t.d(e,{iV:()=>Be,yU:()=>Me,qG:()=>Re,ob:()=>$e,kl:()=>je,e5:()=>Fe,cr:()=>Ae,iF:()=>ke,RF:()=>Ie,qK:()=>qe,_6:()=>Oe,kL:()=>Le,stop:()=>De,s9:()=>Ce,qY:()=>Te,G4:()=>Pe});let n=t=>crypto.getRandomValues(new Uint8Array(t));class i{static get(){return chrome}}var o=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const r="@ANONYMOUS_ID_KEY",a="@SESSION_ID_KEY",s="@GEO",c="@MUTE_KEY",l="@CASHBACK_KEY",u="@AUTOFILL_STATE",d="@ACT_STATE",h="@ACT_KEY",f="@ACT_SLEEK",p="@ACT_COUPONS",v="@ACT_COUPON_INDEX",y="@ACT_ORIGINAL_PRICE",m="@ACT_BEST_COUPON_PRICE",g="@ACT_BEST_COUPON_NAME",w="@ACT_DISCOUNT_PRICES",b="@TAB_WIDGET_VERTICAL_POSITION",_="@CASHBACK_SHOW_SUCCESS_POPUP",x="@TAB_WIDGET_DISABLE_TOGGLE_KEY";class E{static set(t,e){return o(this,void 0,void 0,(function*(){return yield i.get().storage.local.set({[t]:e}),e}))}static get(t){return o(this,void 0,void 0,(function*(){const e=yield i.get().storage.local.get(t);if(e)return e[t]}))}static remove(t){return o(this,void 0,void 0,(function*(){return i.get().storage.local.remove(t)}))}static clear(){return o(this,void 0,void 0,(function*(){return i.get().storage.local.clear()}))}}const S="4.24.0";class k{static logEvent(t,e,n){var i,o,r,a,s;return o=this,r=void 0,s=function*(){try{const o=yield N.generateAnonymousId();yield fetch("https://europe-west2-qoala-analytics.cloudfunctions.net/logEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_name:e,uid:null!==(i=null==t?void 0:t.uid)&&void 0!==i?i:"",anonymous_id:o,platform:"chrome-extension",version:S,test:!1,event_properties:n})})}catch(t){console.log(t)}},new((a=void 0)||(a=Promise))((function(t,e){function n(t){try{c(s.next(t))}catch(t){e(t)}}function i(t){try{c(s.throw(t))}catch(t){e(t)}}function c(e){var o;e.done?t(e.value):(o=e.value,o instanceof a?o:new a((function(t){t(o)}))).then(n,i)}c((s=s.apply(o,r||[])).next())}))}}class A{static logEvent(t,e,n){return i=this,o=void 0,a=function*(){try{if(t.email){const i=yield N.generateAnonymousId();yield fetch(`https://track-eu.customer.io/api/v1/customers/${t.uid}/events`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${btoa("80e947904c5d2d2f7021:d9da67b7c9faceb2c05e")}`},body:JSON.stringify({name:e,data:Object.assign(Object.assign({},n),{anonymous_id:i,test:!1,platform:"chrome-extension",version:S})})})}}catch(t){console.error(t)}},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a}}var C=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const T="Page Viewed",P="Coupon Trial Failed",I="Store Success",O="cashback";class N{static generateAnonymousId(){return C(this,void 0,void 0,(function*(){const t=((t,e=21)=>((t,e,n)=>{let i=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*i*e/t.length);return(r=e)=>{let a="";for(;;){let e=n(o),s=o;for(;s--;)if(a+=t[e[s]&i]||"",a.length===r)return a}}})(t,e,n))("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",21);let e=yield E.get(r);return e||(e=t(),yield E.set(r,e)),e}))}static logEvent(t,e,n){return C(this,void 0,void 0,(function*(){try{yield k.logEvent(t,e,n),t&&(yield A.logEvent(t,e,n))}catch(t){console.log(t)}}))}static getSessionId(){return C(this,void 0,void 0,(function*(){let t=yield E.get(a);return t?t+36e5<Date.now()?(t=Date.now(),yield E.set(a,t),t.toString()):t.toString():(t=Date.now(),yield E.set(a,t),t.toString())}))}}const R="https://qoala-api-7adzuf62ma-nw.a.run.app/",L="https://checkout-service-7adzuf62ma-no.a.run.app/v1",D={SLEEK:"sleek",QOALA:"qoala"},M=JSON.parse('["google.com","google.es","marca.com","twitter.com","as.com","wikipedia.org","elmundo.es","instagram.com","elpais.com","sport.es","20minutes.es","mundodeportivo.com","elespanol.com","youtube.com","facebook.com","twitch.com","twitch.tv","linkedin.com","msn.com","pornhub.com","whatsapp.com","yahoo.com","xvideos.com","onlyfans.com","netflix.com","tiktok.com"]');var B=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const $="@CREATE_TAB_MESSAGE",j="@BROWSER_ICON_TEXT_MESSAGE",F="@CASHBACK_POPUP_CLOSE_MESSAGE",U="@ACT_START_MESSAGE",q="@ACT_SLEEK_START_MESSAGE";class V{static send(t,e){return B(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{i.get().runtime.sendMessage({id:t,payload:e},(t=>{n(t)}))}))}))}static sendDOMMessage(t,e){return B(this,void 0,void 0,(function*(){return window.parent.postMessage({id:t,payload:e},"*")}))}}class z{static fetch(t,e){return n=this,i=void 0,r=function*(){return V.send("@FETCH_REQUEST_MESSAGE",{url:t,request:e})},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function s(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}}var G=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class H{constructor(t,e,n){this.timestamp=t,this.exp=e,this.data=n}static get(t){return G(this,void 0,void 0,(function*(){const e=yield E.get(t.join());if(e)return e.exp>Date.now()?e.data:void 0}))}static write(t,e,n=3e4){return G(this,void 0,void 0,(function*(){return E.set(t.join(),{timestamp:Date.now(),exp:Date.now()+n,data:e})}))}static fetch(t,e,n=3e4){return G(this,void 0,void 0,(function*(){if(!t)return;const i=yield H.get(t);if(i)return i;const o=yield e();return(yield H.write(t,o,n)).data}))}}var Y=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class K{static get(){return Y(this,void 0,void 0,(function*(){return(yield E.get(s))||"es"}))}static set(t="es"){return Y(this,void 0,void 0,(function*(){return E.set(s,t)}))}}var J=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class X{constructor(t,e,n,i,o,r,a,s,c,l,u,d,h,f,p,v,y,m,g,w,b,_){this._id=t,this.active=e,this.joined=n,this.hide_extension_popups=i,this.advertiser_id=o,this.advertiser_name=r,this.host=a,this.geos=s,this.allowed_hostnames=c,this.hide_platforms=l,this.network=u,this.tracking_url=d,this.category=h,this.checkout_url_keyword=f,this.success_url_keyword=p,this.peer_keywords=v,this.cashback=y,this.autofill=m,this.coupon_tester=g,this.epic_qoins=w,this.logo=b,this.banner=_}static query(t){return J(this,void 0,void 0,(function*(){const e=yield K.get(),n=["@ADVERTISER_KEY",t.host,t.hostname,e];if(t.hostname&&M.find((e=>{var n;return e.includes(null!==(n=null==t?void 0:t.hostname)&&void 0!==n?n:"")})))throw Error("Advertiser in blacklist.");return H.fetch(n,(()=>J(this,void 0,void 0,(function*(){const n=new URL(`${R}networkAdvertisers?geo=${e.toLowerCase()}`);Object.entries(t).forEach((t=>{t[1]&&n.searchParams.append(t[0],String(t[1]))}));const i=yield z.fetch(n.toString(),{method:"GET"});if(!i.success)throw new Error("Error getting advertiser.");if(i.data)return i.data[0]}))),3e5)}))}}var W=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class Q{constructor(t,e,n,i,o,r,a){this.uid=t,this.anonymous_id=e,this.email=n,this.name=i,this.createdAt=o,this.photoUrl=r,this.token=a}static get(){return W(this,void 0,void 0,(function*(){return E.get("@AUTH_KEY")}))}static refreshToken(){var t;return W(this,void 0,void 0,(function*(){const e=yield Q.get();return(new URLSearchParams).set("data",JSON.stringify({grant_type:"refresh_token",refresh_token:null==e?void 0:e.token})),(yield z.fetch("https://securetoken.googleapis.com/v1/token?key=AIzaSyDgoYNNtBEjkKS3BwzYvYsuD0-CrdyyXJY",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:null!==(t=null==e?void 0:e.token)&&void 0!==t?t:""}).toString()})).id_token}))}}class Z{static send(t,e,n){return i=this,o=void 0,a=function*(){try{if(!n.epic_qoins.enabled)return;const i=yield K.get(),o=yield Q.get();if(!o)return;const r=yield Q.refreshToken(),a=yield z.fetch("https://europe-west2-qoala-648cc.cloudfunctions.net/EpicTransactionHandler",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({id:n._id,uid:o.uid,platform:"chrome-extension",version:S,geo:i,click_id:t,session_id:e,test:!1})});if(!a.success)throw new Error("Error sending Epic Transaction.");return a.data}catch(t){console.error(t)}},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a}}var tt=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class et{constructor(t,e,n){this.host=t,this.exp=e,this.clickId=n}static set(t,e){return tt(this,void 0,void 0,(function*(){return E.set(l,{host:t,exp:Date.now()+18e5,clickId:e})}))}static get(){return tt(this,void 0,void 0,(function*(){return E.get(l)}))}static isActive(t){return tt(this,void 0,void 0,(function*(){const e=yield E.get(l);return!!e&&e.host===t&&e.exp>Date.now()}))}}class nt{static log(t,e){return n=this,i=void 0,r=function*(){const n=yield Q.get();return V.send("@EVENT_LOG_MESSAGE",{auth:n,eventName:t,eventProperties:e})},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function s(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}}class it{static create(t){return e=this,n=void 0,o=function*(){return yield z.fetch("https://qoala-linktrack-prod-7adzuf62ma-no.a.run.app/clicks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t.url,current_url:t.current_url,uid:t.uid,anonymous_id:t.anonymous_id,deal_id:t.offer_id,host:t.host,network_id:t.network_id,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:t.context,platform:"chrome-extension",session:yield N.getSessionId(),version:S})})},new((i=void 0)||(i=Promise))((function(t,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}));var e,n,i,o}}var ot=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class rt{static open(t,e=!1){return ot(this,void 0,void 0,(function*(){return V.send($,{url:t,pinned:e})}))}static redirectFromWindowContext(t,e){window&&(console.info("Redirecting from window context",t,e),e?window.location.href=t:window.open(t))}static openTrackingUrl(t,e,n=!0,i=!1){var o;return ot(this,void 0,void 0,(function*(){const r=yield Q.get(),a=yield N.generateAnonymousId();let s={id:"",url:t,redirect_url:t};try{s=yield it.create({url:t,current_url:e.current_url,uid:null!==(o=null==r?void 0:r.uid)&&void 0!==o?o:"",anonymous_id:a,host:e.host,network_id:e.network,advertiser_id:e.advertiser_id,advertiser_name:e.advertiser_name,context:e.context,offer_id:e.offer_id})}catch(t){console.log(t)}yield et.set(e.host,s.id);try{yield nt.log("Link Clicked",{host:e.host,network:e.network,category:e.category,context:e.context,url:s.url,click_id:s.id,deal_id:e.offer_id,type:e.type})}catch(t){console.log(t)}yield E.set(_,!0),n?(setTimeout((()=>{rt.redirectFromWindowContext(s.redirect_url,n)}),5e3),yield V.send("@UPDATE_TAB_MESSAGE",{url:s.redirect_url})):yield V.send($,{url:s.redirect_url,pinned:i})}))}}var at=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class st{constructor(t,e){this.host=t,this.exp=e}static mute(t,e=18e5){return at(this,void 0,void 0,(function*(){return E.set([c,t].join(),{host:t,exp:Date.now()+e})}))}static isMuted(t){return at(this,void 0,void 0,(function*(){if(yield E.get("@DEV_MUTE_FLAG"))return!1;const e=yield E.get([c,t].join());return!!e&&e.exp>Date.now()}))}}const ct={aliexpress:{entrypoints:[{selector:".comet-btn.comet-btn-link.pl-address-item__new-btn",required_fields:["shippingAddresses","cardInformation"]},{selector:'[data-pl="payment-root"] [data-pl="payment-method-title"]',required_fields:["cardInformation"]}]},fnac:{entrypoints:[{selector:"#lastName",required_fields:["shippingAddresses","cardInformation","nif","gender"]},{selector:'input[id="Tarjeta bancaria"]',required_fields:["cardInformation"]}]},miravia:{entrypoints:[{selector:'img[data-spm="add_new_address"]',required_fields:["shippingAddresses","cardInformation"]},{selector:".addCard--hv0y9RS .cardItem--_vDgBaq",required_fields:["cardInformation"]}]},myprotein:{entrypoints:[{selector:'input[name="deliveryAddress.addressee"]',required_fields:["shippingAddresses","cardInformation"]}]},mediamarkt:{entrypoints:[{selector:"#customer_customerTaxId",required_fields:["shippingAddresses","cardInformation","nif","gender"]},{selector:"#MMSKKNr",required_fields:["cardInformation"]}]},shein:{entrypoints:[{selector:"span.manual-btn.mb-20",required_fields:["shippingAddresses","cardInformation"]},{selector:"#cardInput",required_fields:["cardInformation"]}]},zara:{entrypoints:[{selector:'form#address-form input[name="firstName"]',required_fields:["shippingAddresses","cardInformation"]},{selector:"#\\31 001",required_fields:["shippingAddresses","cardInformation"]},{selector:"#\\31 002",required_fields:["shippingAddresses","cardInformation"]}]},zooplus:{entrypoints:[{selector:'div[aria-hidden="false"][class="section__input v3-shadowBox"] #shippingCustomerFirstName',required_fields:["shippingAddresses","cardInformation"]},{selector:'div[aria-hidden="false"][class="section__input v3-shadowBox"] #paymentForm input[name="cardNumber"]',required_fields:["cardInformation"]},{selector:"form button#makeTheOrder",required_fields:[]}],options:{attributes:!0}},bershka:{entrypoints:[{selector:'input[name="name"].ng-pristine.ng-untouched.ng-empty.ng-invalid.ng-invalid-required.ng-valid-maxlength.ng-valid-latin-chars',required_fields:["shippingAddresses","cardInformation"]},{selector:".action-edit.table-cell span.sc-title-link",required_fields:["shippingAddresses","cardInformation"]}]},primor:{entrypoints:[{selector:"a.shipping-step__new-link.link",required_fields:["shippingAddresses"]},{selector:'div[name="shippingAddress.firstname"]',required_fields:["shippingAddresses"]}]}};var lt,ut,dt,ht,ft=function(){return ft=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},ft.apply(this,arguments)};function pt(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}function vt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function yt(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function mt(t,e,n){if(n||2===arguments.length)for(var i,o=0,r=e.length;o<r;o++)!i&&o in e||(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))}(ht=lt||(lt={})).Start="xstate.start",ht.Stop="xstate.stop",ht.Raise="xstate.raise",ht.Send="xstate.send",ht.Cancel="xstate.cancel",ht.NullEvent="",ht.Assign="xstate.assign",ht.After="xstate.after",ht.DoneState="done.state",ht.DoneInvoke="done.invoke",ht.Log="xstate.log",ht.Init="xstate.init",ht.Invoke="xstate.invoke",ht.ErrorExecution="error.execution",ht.ErrorCommunication="error.communication",ht.ErrorPlatform="error.platform",ht.ErrorCustom="xstate.error",ht.Update="xstate.update",ht.Pure="xstate.pure",ht.Choose="xstate.choose",(dt=ut||(ut={})).Parent="#_parent",dt.Internal="#_internal";var gt,wt={},bt="xstate.guard",_t=lt.Start,xt=lt.Stop,Et=lt.Raise,St=lt.Send,kt=lt.Cancel,At=lt.NullEvent,Ct=lt.Assign,Tt=(lt.After,lt.DoneState,lt.Log),Pt=lt.Init,It=lt.Invoke,Ot=(lt.ErrorExecution,lt.ErrorPlatform),Nt=lt.ErrorCustom,Rt=lt.Update,Lt=lt.Choose,Dt=lt.Pure,Mt=!0;function Bt(t,e,n){void 0===n&&(n=".");var i=Ft(t,n),o=Ft(e,n);return ne(o)?!!ne(i)&&o===i:ne(i)?i in o:Object.keys(i).every((function(t){return t in o&&Bt(i[t],o[t])}))}function $t(t){try{return ne(t)||"number"==typeof t?"".concat(t):t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function jt(t,e){try{return te(t)?t:t.toString().split(e)}catch(e){throw new Error("'".concat(t,"' is not a valid state path."))}}function Ft(t,e){return"object"==typeof(n=t)&&"value"in n&&"context"in n&&"event"in n&&"_event"in n?t.value:te(t)?Ut(t):"string"!=typeof t?t:Ut(jt(t,e));var n}function Ut(t){if(1===t.length)return t[0];for(var e={},n=e,i=0;i<t.length-1;i++)i===t.length-2?n[t[i]]=t[i+1]:(n[t[i]]={},n=n[t[i]]);return e}function qt(t,e){for(var n={},i=Object.keys(t),o=0;o<i.length;o++){var r=i[o];n[r]=e(t[r],r,t,o)}return n}function Vt(t,e,n){var i,o,r={};try{for(var a=vt(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,l=t[c];n(l)&&(r[c]=e(l,c,t))}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return r}var zt=function(t){return function(e){var n,i,o=e;try{for(var r=vt(t),a=r.next();!a.done;a=r.next())o=o[a.value]}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return o}};function Gt(t){return t?ne(t)?[[t]]:Ht(Object.keys(t).map((function(e){var n=t[e];return"string"==typeof n||n&&Object.keys(n).length?Gt(t[e]).map((function(t){return[e].concat(t)})):[[e]]}))):[[]]}function Ht(t){var e;return(e=[]).concat.apply(e,mt([],yt(t),!1))}function Yt(t){return te(t)?t:[t]}function Kt(t){return void 0===t?[]:Yt(t)}function Jt(t,e,n){var i,o;if(ee(t))return t(e,n.data);var r={};try{for(var a=vt(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,l=t[c];ee(l)?r[c]=l(e,n.data):r[c]=l}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return r}function Xt(t){return t instanceof Promise||!(null===t||!ee(t)&&"object"!=typeof t||!ee(t.then))}function Wt(t,e){return qt(t.states,(function(t,n){if(t){var i=(ne(e)?void 0:e[n])||(t?t.current:void 0);if(i)return{current:i,states:Wt(t,i)}}}))}function Qt(t,e,n,i){Mt||Zt(!!t,"Attempting to update undefined context");var o=t?n.reduce((function(t,n){var o,r,a=n.assignment,s={state:i,action:n,_event:e},c={};if(ee(a))c=a(t,e.data,s);else try{for(var l=vt(Object.keys(a)),u=l.next();!u.done;u=l.next()){var d=u.value,h=a[d];c[d]=ee(h)?h(t,e.data,s):h}}catch(t){o={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return Object.assign({},t,c)}),t):t;return o}var Zt=function(){};function te(t){return Array.isArray(t)}function ee(t){return"function"==typeof t}function ne(t){return"string"==typeof t}function ie(t,e){if(t)return ne(t)?{type:bt,name:t,predicate:e?e[t]:void 0}:ee(t)?{type:bt,name:t.name,predicate:t}:t}Mt||(Zt=function(t,e){var n=t instanceof Error?t:void 0;if((n||!t)&&void 0!==console){var i=["Warning: ".concat(e)];n&&i.push(n),console.warn.apply(console,i)}});var oe=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function re(t){return!!t&&"__xstatenode"in t}function ae(t,e){return ne(t)||"number"==typeof t?ft({type:t},e):t}function se(t,e){if(!ne(t)&&"$$type"in t&&"scxml"===t.$$type)return t;var n=ae(t);return ft({name:n.type,data:n,$$type:"scxml",type:"external"},e)}function ce(t,e){return Yt(e).map((function(e){return void 0===e||"string"==typeof e||re(e)?{target:e,event:t}:ft(ft({},e),{event:t})}))}function le(t,e,n,i,o){var r=t.options.guards,a={state:o,cond:e,_event:i};if(e.type===bt)return((null==r?void 0:r[e.name])||e.predicate)(n,i.data,a);var s=null==r?void 0:r[e.type];if(!s)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return s(n,i.data,a)}function ue(t){return"string"==typeof t?{type:t}:t}function de(t,e,n){var i=function(){},o="object"==typeof t,r=o?t:null;return{next:((o?t.next:t)||i).bind(r),error:((o?t.error:e)||i).bind(r),complete:((o?t.complete:n)||i).bind(r)}}function he(t,e){return"".concat(t,":invocation[").concat(e,"]")}function fe(t){return(t.type===Et||t.type===St&&t.to===ut.Internal)&&"number"!=typeof t.delay}(gt={})[oe]=function(){return this},gt[Symbol.observable]=function(){return this};var pe=function(t){return"atomic"===t.type||"final"===t.type};function ve(t){return Object.keys(t.states).map((function(e){return t.states[e]}))}function ye(t){return ve(t).filter((function(t){return"history"!==t.type}))}function me(t){var e=[t];return pe(t)?e:e.concat(Ht(ye(t).map(me)))}function ge(t,e){var n,i,o,r,a,s,c,l,u=be(new Set(t)),d=new Set(e);try{for(var h=vt(d),f=h.next();!f.done;f=h.next())for(var p=(E=f.value).parent;p&&!d.has(p);)d.add(p),p=p.parent}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}var v=be(d);try{for(var y=vt(d),m=y.next();!m.done;m=y.next())if("compound"!==(E=m.value).type||v.get(E)&&v.get(E).length){if("parallel"===E.type)try{for(var g=(a=void 0,vt(ye(E))),w=g.next();!w.done;w=g.next()){var b=w.value;d.has(b)||(d.add(b),u.get(b)?u.get(b).forEach((function(t){return d.add(t)})):b.initialStateNodes.forEach((function(t){return d.add(t)})))}}catch(t){a={error:t}}finally{try{w&&!w.done&&(s=g.return)&&s.call(g)}finally{if(a)throw a.error}}}else u.get(E)?u.get(E).forEach((function(t){return d.add(t)})):E.initialStateNodes.forEach((function(t){return d.add(t)}))}catch(t){o={error:t}}finally{try{m&&!m.done&&(r=y.return)&&r.call(y)}finally{if(o)throw o.error}}try{for(var _=vt(d),x=_.next();!x.done;x=_.next()){var E;for(p=(E=x.value).parent;p&&!d.has(p);)d.add(p),p=p.parent}}catch(t){c={error:t}}finally{try{x&&!x.done&&(l=_.return)&&l.call(_)}finally{if(c)throw c.error}}return d}function we(t,e){var n=e.get(t);if(!n)return{};if("compound"===t.type){var i=n[0];if(!i)return{};if(pe(i))return i.key}var o={};return n.forEach((function(t){o[t.key]=we(t,e)})),o}function be(t){var e,n,i=new Map;try{for(var o=vt(t),r=o.next();!r.done;r=o.next()){var a=r.value;i.has(a)||i.set(a,[]),a.parent&&(i.has(a.parent)||i.set(a.parent,[]),i.get(a.parent).push(a))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i}function _e(t,e){return we(t,be(ge([t],e)))}function xe(t,e){return Array.isArray(t)?t.some((function(t){return t===e})):t instanceof Set&&t.has(e)}function Ee(t,e){return"compound"===e.type?ye(e).some((function(e){return"final"===e.type&&xe(t,e)})):"parallel"===e.type&&ye(e).every((function(e){return Ee(t,e)}))}function Se(t){return new Set(Ht(t.map((function(t){return t.tags}))))}var ke=se({type:Pt});function Ae(t,e){return e&&e[t]||void 0}function Ce(t,e){var n;if(ne(t)||"number"==typeof t)n=ee(i=Ae(t,e))?{type:t,exec:i}:i||{type:t,exec:void 0};else if(ee(t))n={type:t.name||t.toString(),exec:t};else{var i;if(ee(i=Ae(t.type,e)))n=ft(ft({},t),{exec:i});else if(i){var o=i.type||t.type;n=ft(ft(ft({},i),t),{type:o})}else n=t}return n}var Te=function(t,e){return t?(te(t)?t:[t]).map((function(t){return Ce(t,e)})):[]};function Pe(t){var e=Ce(t);return ft(ft({id:ne(t)?t:e.id},e),{type:e.type})}function Ie(t,e){return{type:Et,event:"function"==typeof t?t:ae(t),delay:e?e.delay:void 0,id:null==e?void 0:e.id}}function Oe(t,e){return{to:e?e.to:void 0,type:St,event:ee(t)?t:ae(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:ee(t)?t.name:$t(t)}}var Ne=function(t,e,n){return ft(ft({},t),{value:ne(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})},Re=function(t){return{type:kt,sendId:t}};function Le(t){var e=Pe(t);return{type:lt.Start,activity:e,exec:void 0}}function De(t){var e=ee(t)?t:Pe(t);return{type:lt.Stop,activity:e,exec:void 0}}var Me=function(t){return{type:Ct,assignment:t}};function Be(t,e){var n=e?"#".concat(e):"";return"".concat(lt.After,"(").concat(t,")").concat(n)}function $e(t,e){var n="".concat(lt.DoneState,".").concat(t);return{type:n,data:e,toString:function(){return n}}}function je(t,e){var n="".concat(lt.DoneInvoke,".").concat(t);return{type:n,data:e,toString:function(){return n}}}function Fe(t,e){var n="".concat(lt.ErrorPlatform,".").concat(t);return{type:n,data:e,toString:function(){return n}}}var Ue=function(t){var e,n,i=[];try{for(var o=vt(t),r=o.next();!r.done;r=o.next())for(var a=r.value,s=0;s<a.actions.length;)a.actions[s].type!==Ct?s++:(i.push(a.actions[s]),a.actions.splice(s,1))}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i};function qe(t,e,n,i,o,r,a){void 0===a&&(a=!1);var s=a?[]:Ue(o),c=s.length?Qt(n,i,s,e):n,l=a?[n]:void 0,u=[];function d(o,s){var d;switch(s.type){case Et:var h=function(t,e,n,i){var o,r={_event:n},a=se(ee(t.event)?t.event(e,n.data,r):t.event);if(ne(t.delay)){var s=i&&i[t.delay];o=ee(s)?s(e,n.data,r):s}else o=ee(t.delay)?t.delay(e,n.data,r):t.delay;return ft(ft({},t),{type:Et,_event:a,delay:o})}(s,c,i,t.options.delays);return r&&"number"==typeof h.delay&&r(h,c,i),h;case St:var f=function(t,e,n,i){var o,r={_event:n},a=se(ee(t.event)?t.event(e,n.data,r):t.event);if(ne(t.delay)){var s=i&&i[t.delay];o=ee(s)?s(e,n.data,r):s}else o=ee(t.delay)?t.delay(e,n.data,r):t.delay;var c=ee(t.to)?t.to(e,n.data,r):t.to;return ft(ft({},t),{to:c,_event:a,event:a.data,delay:o})}(s,c,i,t.options.delays);if(!Mt){var p=s.delay;Zt(!ne(p)||"number"==typeof f.delay,"No delay reference for delay expression '".concat(p,"' was found on machine '").concat(t.id,"'"))}return r&&f.to!==ut.Internal&&("entry"===o?u.push(f):r(f,c,i)),f;case Tt:var v=Ne(s,c,i);return null==r||r(v,c,i),v;case Lt:if(!(w=null===(d=s.conds.find((function(n){var o=ie(n.cond,t.options.guards);return!o||le(t,o,c,i,r?void 0:e)})))||void 0===d?void 0:d.actions))return[];var y=yt(qe(t,e,c,i,[{type:o,actions:Te(Kt(w),t.options.actions)}],r,a),2),m=y[0],g=y[1];return c=g,null==l||l.push(c),m;case Dt:var w;if(!(w=s.get(c,i.data)))return[];var b=yt(qe(t,e,c,i,[{type:o,actions:Te(Kt(w),t.options.actions)}],r,a),2),_=b[0],x=b[1];return c=x,null==l||l.push(c),_;case xt:return v=function(t,e,n){var i=ee(t.activity)?t.activity(e,n.data):t.activity,o="string"==typeof i?{id:i}:i;return{type:lt.Stop,activity:o}}(s,c,i),null==r||r(v,n,i),v;case Ct:c=Qt(c,i,[s],r?void 0:e),null==l||l.push(c);break;default:var E=Ce(s,t.options.actions),S=E.exec;if(r)r(E,c,i);else if(S&&l){var k=l.length-1,A=ft(ft({},E),{exec:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];S.apply(void 0,mt([l[k]],yt(e),!1))}});E=A}return E}}var h=Ht(o.map((function(t){var e,n,o=[];try{for(var a=vt(t.actions),s=a.next();!s.done;s=a.next()){var l=s.value,h=d(t.type,l);h&&(o=o.concat(h))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return u.forEach((function(t){r(t,c,i)})),u.length=0,o})));return[h,c]}function Ve(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;if(ne(t)||ne(e))return t===e;var n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&n.every((function(n){return Ve(t[n],e[n])}))}var ze=function(){function t(t){var e,n,i=this;this.actions=[],this.activities=wt,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||wt,this.meta=(void 0===(n=t.configuration)&&(n=[]),n.reduce((function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t}),{})),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=null!==(e=Array.isArray(t.tags)?new Set(t.tags):t.tags)&&void 0!==e?e:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return function(t){return mt([],yt(new Set(Ht(mt([],yt(t.map((function(t){return t.ownEvents}))),!1)))),!1)}(i.configuration)}})}return t.from=function(e,n){return e instanceof t?e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e:new t({value:e,context:n,_event:ke,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var i=ke;return new t({value:e.value,context:n,_event:i,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),ne(t))return[t];var i=Object.keys(t);return i.concat.apply(i,mt([],yt(i.map((function(i){return n.toStrings(t[i],e).map((function(t){return i+e+t}))}))),!1))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var n=pt(t,["configuration","transitions","tags","machine"]);return ft(ft({},n),{tags:Array.from(e)})},t.prototype.matches=function(t){return Bt(t,this.value)},t.prototype.hasTag=function(t){return this.tags.has(t)},t.prototype.can=function(t){var e;Mt&&Zt(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=null===(e=this.machine)||void 0===e?void 0:e.getTransitionData(this,t);return!!(null==n?void 0:n.transitions.length)&&n.transitions.some((function(t){return void 0!==t.target||t.actions.length}))},t}(),Ge={deferEvents:!1},He=function(){function t(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=ft(ft({},Ge),t)}return t.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()},t.prototype.schedule=function(t){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},t.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},t}(),Ye=[],Ke=function(t,e){Ye.push(t);var n=e(t);return Ye.pop(),n};function Je(t){var e;return(e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}})[oe]=function(){return this},e}function Xe(t,e,n){var i=Je(e);if(i.deferred=!0,re(t)){var o=i.state=Ke(void 0,(function(){return(n?t.withContext(n):t).initialState}));i.getSnapshot=function(){return o}}return i}var We=new Map,Qe=0,Ze=function(t){We.delete(t)};function tn(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:void(Mt||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues"))}var en,nn={sync:!1,autoForward:!1};!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(en||(en={}));var on=function(){function t(e,n){void 0===n&&(n=t.defaultOptions);var i=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=en.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(t,e){if(te(t))return i.batch(t),i.state;var n=se(ae(t,e));if(i.status===en.Stopped)return Mt||Zt(!1,'Event "'.concat(n.name,'" was sent to stopped service "').concat(i.machine.id,'". This service has already reached its final state, and will not transition.\nEvent: ').concat(JSON.stringify(n.data))),i.state;if(i.status!==en.Running&&!i.options.deferEvents)throw new Error('Event "'.concat(n.name,'" was sent to uninitialized service "').concat(i.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(n.data)));return i.scheduler.schedule((function(){i.forward(n);var t=i._nextState(n);i.update(t,n)})),i._state},this.sendTo=function(t,e,n){var o,r=i.parent&&(e===ut.Parent||i.parent.id===e),a=r?i.parent:ne(e)?e===ut.Internal?i:i.children.get(e)||function(t){return We.get(t)}(e):(o=e)&&"function"==typeof o.send?e:void 0;if(a)if("machine"in a){if(i.status!==en.Stopped||i.parent!==a||i.state.done){var s=ft(ft({},t),{name:t.name===Nt?"".concat(Fe(i.id)):t.name,origin:i.sessionId});!n&&i.machine.config.predictableActionArguments?i._outgoingQueue.push([a,s]):a.send(s)}}else!n&&i.machine.config.predictableActionArguments?i._outgoingQueue.push([a,t.data]):a.send(t.data);else{if(!r)throw new Error("Unable to send event to child '".concat(e,"' from service '").concat(i.id,"'."));Mt||Zt(!1,"Service '".concat(i.id,"' has no parent: unable to send event ").concat(t.type))}},this._exec=function(t,e,n,o){void 0===o&&(o=i.machine.options.actions);var r=t.exec||Ae(t.type,o),a=ee(r)?r:r?r.exec:t.exec;if(a)try{return a(e,n.data,i.machine.config.predictableActionArguments?{action:t,_event:n}:{action:t,state:i.state,_event:n})}catch(t){throw i.parent&&i.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case Et:var s=t;i.defer(s);break;case St:var c=t;if("number"==typeof c.delay)return void i.defer(c);c.to?i.sendTo(c._event,c.to,n===ke):i.send(c._event);break;case kt:i.cancel(t.sendId);break;case _t:if(i.status!==en.Running)return;var l=t.activity;if(!i.machine.config.predictableActionArguments&&!i.state.activities[l.id||l.type])break;if(l.type===lt.Invoke){var u=ue(l.src),d=i.machine.options.services?i.machine.options.services[u.type]:void 0,h=l.id,f=l.data;Mt||Zt(!("forward"in l),"`forward` property is deprecated (found in invocation of '".concat(l.src,"' in in machine '").concat(i.machine.id,"'). ")+"Please use `autoForward` instead.");var p="autoForward"in l?l.autoForward:!!l.forward;if(!d)return void(Mt||Zt(!1,"No service found for invocation '".concat(l.src,"' in machine '").concat(i.machine.id,"'.")));var v=f?Jt(f,e,n):void 0;if("string"==typeof d)return;var y=ee(d)?d(e,n.data,{data:v,src:u,meta:l.meta}):d;if(!y)return;var m=void 0;re(y)&&(y=v?y.withContext(v):y,m={autoForward:p}),i.spawn(y,h,m)}else i.spawnActivity(l);break;case xt:i.stopChild(t.activity.id);break;case Tt:var g=t,w=g.label,b=g.value;w?i.logger(w,b):i.logger(b);break;default:Mt||Zt(!1,"No implementation found for action type '".concat(t.type,"'"))}};var o=ft(ft({},t.defaultOptions),n),r=o.clock,a=o.logger,s=o.parent,c=o.id,l=void 0!==c?c:e.id;this.id=l,this.logger=a,this.clock=r,this.parent=s,this.options=o,this.scheduler=new He({deferEvents:this.options.deferEvents}),this.sessionId="x:".concat(Qe++)}return Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:Ke(this,(function(){return t._initialState=t.machine.initialState,t._initialState}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return Mt||Zt(this.status!==en.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(t,e){var n,i;try{for(var o=vt(t.actions),r=o.next();!r.done;r=o.next()){var a=r.value;this.exec(a,t,e)}}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},t.prototype.update=function(t,e){var n,i,o,r,a,s,c,l,u=this;if(t._sessionid=this.sessionId,this._state=t,this.machine.config.predictableActionArguments&&e!==ke||!this.options.execute)for(var d=void 0;d=this._outgoingQueue.shift();)d[0].send(d[1]);else this.execute(this.state);if(this.children.forEach((function(t){u.state.children[t.id]=t})),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var h=vt(this.eventListeners),f=h.next();!f.done;f=h.next())(0,f.value)(t.event)}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}try{for(var p=vt(this.listeners),v=p.next();!v.done;v=p.next())(0,v.value)(t,t.event)}catch(t){o={error:t}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(o)throw o.error}}try{for(var y=vt(this.contextListeners),m=y.next();!m.done;m=y.next())(0,m.value)(this.state.context,this.state.history?this.state.history.context:void 0)}catch(t){a={error:t}}finally{try{m&&!m.done&&(s=y.return)&&s.call(y)}finally{if(a)throw a.error}}if(this.state.done){var g=t.configuration.find((function(t){return"final"===t.type&&t.parent===u.machine})),w=g&&g.doneData?Jt(g.doneData,t.context,e):void 0;this._doneEvent=je(this.id,w);try{for(var b=vt(this.doneListeners),_=b.next();!_.done;_=b.next())(0,_.value)(this._doneEvent)}catch(t){c={error:t}}finally{try{_&&!_.done&&(l=b.return)&&l.call(b)}finally{if(c)throw c.error}}this._stop(),this._stopChildren(),Ze(this.sessionId)}},t.prototype.onTransition=function(t){return this.listeners.add(t),this.status===en.Running&&t(this.state,this.state.event),this},t.prototype.subscribe=function(t,e,n){var i=this,o=de(t,e,n);this.listeners.add(o.next),this.status!==en.NotStarted&&o.next(this.state);var r=function(){i.doneListeners.delete(r),i.stopListeners.delete(r),o.complete()};return this.status===en.Stopped?o.complete():(this.onDone(r),this.onStop(r)),{unsubscribe:function(){i.listeners.delete(o.next),i.doneListeners.delete(r),i.stopListeners.delete(r)}}},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.status===en.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){var e,n,i=this;if(this.status===en.Running)return this;this.machine._init(),e=this.sessionId,n=this,We.set(e,n),this.initialized=!0,this.status=en.Running;var o=void 0===t?this.initialState:Ke(this,(function(){return"object"==typeof(e=t)&&null!==e&&"value"in e&&"_event"in e?i.machine.resolveState(t):i.machine.resolveState(ze.from(t,i.machine.context));var e}));return this.options.devTools&&this.attachDev(),this.scheduler.initialize((function(){i.update(o,ke)})),this},t.prototype._stopChildren=function(){this.children.forEach((function(t){ee(t.stop)&&t.stop()})),this.children.clear()},t.prototype._stop=function(){var t,e,n,i,o,r,a,s,c,l;try{for(var u=vt(this.listeners),d=u.next();!d.done;d=u.next()){var h=d.value;this.listeners.delete(h)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}try{for(var f=vt(this.stopListeners),p=f.next();!p.done;p=f.next())(h=p.value)(),this.stopListeners.delete(h)}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var v=vt(this.contextListeners),y=v.next();!y.done;y=v.next())h=y.value,this.contextListeners.delete(h)}catch(t){o={error:t}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(o)throw o.error}}try{for(var m=vt(this.doneListeners),g=m.next();!g.done;g=m.next())h=g.value,this.doneListeners.delete(h)}catch(t){a={error:t}}finally{try{g&&!g.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}if(!this.initialized)return this;this.initialized=!1,this.status=en.Stopped,this._initialState=void 0;try{for(var w=vt(Object.keys(this.delayedEventsMap)),b=w.next();!b.done;b=w.next()){var _=b.value;this.clock.clearTimeout(this.delayedEventsMap[_])}}catch(t){c={error:t}}finally{try{b&&!b.done&&(l=w.return)&&l.call(w)}finally{if(c)throw c.error}}this.scheduler.clear(),this.scheduler=new He({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var t=this,e=this.scheduler;return this._stop(),e.schedule((function(){var e=se({type:"xstate.stop"}),n=Ke(t,(function(){var n=Ht(mt([],yt(t.state.configuration),!1).sort((function(t,e){return e.order-t.order})).map((function(e){return Te(e.onExit,t.machine.options.actions)}))),i=yt(qe(t.machine,t.state,t.state.context,e,[{type:"exit",actions:n}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),o=i[0],r=i[1],a=new ze({value:t.state.value,context:r,_event:e,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:o.filter((function(t){return!fe(t)})),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return a.changed=!0,a}));t.update(n,e),t._stopChildren(),Ze(t.sessionId)})),this},t.prototype.batch=function(t){var e=this;if(this.status===en.NotStarted&&this.options.deferEvents)Mt||Zt(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'" and are deferred. Make sure .start() is called for this service.\nEvent: ').concat(JSON.stringify(event)));else if(this.status!==en.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule((function(){var i,o,r=e.state,a=!1,s=[],c=function(t){var i=se(t);e.forward(i),r=Ke(e,(function(){return e.machine.transition(r,i,void 0,n||void 0)})),s.push.apply(s,mt([],yt(e.machine.config.predictableActionArguments?r.actions:r.actions.map((function(t){return function(t,e){var n=t.exec;return ft(ft({},t),{exec:void 0!==n?function(){return n(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0})}(t,r)}))),!1)),a=a||!!r.changed};try{for(var l=vt(t),u=l.next();!u.done;u=l.next())c(u.value)}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}r.changed=a,r.actions=s,e.update(r,se(t[t.length-1]))}))}},t.prototype.sender=function(t){return this.send.bind(this,t)},t.prototype._nextState=function(t,e){var n=this;void 0===e&&(e=!!this.machine.config.predictableActionArguments&&this._exec);var i=se(t);if(0===i.name.indexOf(Ot)&&!this.state.nextEvents.some((function(t){return 0===t.indexOf(Ot)})))throw i.data.data;return Ke(this,(function(){return n.machine.transition(n.state,i,void 0,e||void 0)}))},t.prototype.nextState=function(t){return this._nextState(t,!1)},t.prototype.forward=function(t){var e,n;try{for(var i=vt(this.forwardTo),o=i.next();!o.done;o=i.next()){var r=o.value,a=this.children.get(r);if(!a)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(r,"'."));a.send(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.defer=function(t){var e=this,n=this.clock.setTimeout((function(){"to"in t&&t.to?e.sendTo(t._event,t.to,!0):e.send(t._event)}),t.delay);t.id&&(this.delayedEventsMap[t.id]=n)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,e,n){void 0===n&&(n=this.machine.options.actions),this._exec(t,e.context,e._event,n)},t.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),null===(e=this.state)||void 0===e||delete e.children[t]},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),ee(e.stop)&&e.stop())},t.prototype.spawn=function(t,e,n){if(this.status!==en.Running)return Xe(t,e);if(Xt(t))return this.spawnPromise(Promise.resolve(t),e);if(ee(t))return this.spawnCallback(t,e);if(function(t){try{return"function"==typeof t.send}catch(t){return!1}}(o=t)&&"id"in o)return this.spawnActor(t,e);if(function(t){try{return"subscribe"in t&&ee(t.subscribe)}catch(t){return!1}}(t))return this.spawnObservable(t,e);if(re(t))return this.spawnMachine(t,ft(ft({},n),{id:e}));if(null!==(i=t)&&"object"==typeof i&&"transition"in i&&"function"==typeof i.transition)return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'));var i,o},t.prototype.spawnMachine=function(e,n){var i=this;void 0===n&&(n={});var o=new t(e,ft(ft({},this.options),{parent:this,id:n.id||e.id})),r=ft(ft({},nn),n);r.sync&&o.onTransition((function(t){i.send(Rt,{state:t,id:o.id})}));var a=o;return this.children.set(o.id,a),r.autoForward&&this.forwardTo.add(o.id),o.onDone((function(t){i.removeChild(o.id),i.send(se(t,{origin:o.id}))})).start(),a},t.prototype.spawnBehavior=function(t,e){var n=function(t,e){void 0===e&&(e={});var n=t.initialState,i=new Set,o=[],r=!1,a=function(t){var e;return ft(((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}})[oe]=function(){return this},e),t)}({id:e.id,send:function(e){o.push(e),function(){if(!r){for(r=!0;o.length>0;){var e=o.shift();n=t.transition(n,e,s),i.forEach((function(t){return t.next(n)}))}r=!1}}()},getSnapshot:function(){return n},subscribe:function(t,e,o){var r=de(t,e,o);return i.add(r),r.next(n),{unsubscribe:function(){i.delete(r)}}}}),s={parent:e.parent,self:a,id:e.id||"anonymous",observers:i};return n=t.start?t.start(s):n,a}(t,{id:e,parent:this});return this.children.set(e,n),n},t.prototype.spawnPromise=function(t,e){var n,i,o=this,r=!1;t.then((function(t){r||(i=t,o.removeChild(e),o.send(se(je(e,t),{origin:e})))}),(function(t){if(!r){o.removeChild(e);var n=Fe(e,t);try{o.send(se(n,{origin:e}))}catch(i){!function(t,e,n){if(!Mt){var i=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(n,"', error was '").concat(t,"'.").concat(i));else{var o=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(n,"'. ")+"Original error: '".concat(t,"'. ").concat(i," Current error is '").concat(e,"'.").concat(o))}}}(t,i,e),o.devTools&&o.devTools.send(n,o.state),o.machine.strict&&o.stop()}}}));var a=((n={id:e,send:function(){},subscribe:function(e,n,i){var o=de(e,n,i),r=!1;return t.then((function(t){r||(o.next(t),r||o.complete())}),(function(t){r||o.error(t)})),{unsubscribe:function(){return r=!0}}},stop:function(){r=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return i}})[oe]=function(){return this},n);return this.children.set(e,a),a},t.prototype.spawnCallback=function(t,e){var n,i,o,r=this,a=!1,s=new Set,c=new Set;try{o=t((function(t){i=t,c.forEach((function(e){return e(t)})),a||r.send(se(t,{origin:e}))}),(function(t){s.add(t)}))}catch(t){this.send(Fe(e,t))}if(Xt(o))return this.spawnPromise(o,e);var l=((n={id:e,send:function(t){return s.forEach((function(e){return e(t)}))},subscribe:function(t){var e=de(t);return c.add(e.next),{unsubscribe:function(){c.delete(e.next)}}},stop:function(){a=!0,ee(o)&&o()},toJSON:function(){return{id:e}},getSnapshot:function(){return i}})[oe]=function(){return this},n);return this.children.set(e,l),l},t.prototype.spawnObservable=function(t,e){var n,i,o=this,r=t.subscribe((function(t){i=t,o.send(se(t,{origin:e}))}),(function(t){o.removeChild(e),o.send(se(Fe(e,t),{origin:e}))}),(function(){o.removeChild(e),o.send(se(je(e),{origin:e}))})),a=((n={id:e,send:function(){},subscribe:function(e,n,i){return t.subscribe(e,n,i)},stop:function(){return r.unsubscribe()},getSnapshot:function(){return i},toJSON:function(){return{id:e}}})[oe]=function(){return this},n);return this.children.set(e,a),a},t.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},t.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var n=e(this.state.context,t);this.spawnEffect(t.id,n)}else Mt||Zt(!1,"No implementation found for activity '".concat(t.type,"'"))},t.prototype.spawnEffect=function(t,e){var n;this.children.set(t,((n={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})[oe]=function(){return this},n))},t.prototype.attachDev=function(){var t=tn();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(ft(ft({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},e),{features:ft({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}!function(t){if(tn()){var e=function(){var t=tn();if(t&&"__xstate__"in t)return t.__xstate__}();e&&e.register(t)}}(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[oe]=function(){return this},t.prototype.getSnapshot=function(){return this.status===en.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},t.interpret=rn,t}();function rn(t,e){return new on(t,e)}const an=[{selector:'img[data-spm="add_new_address"]',action:"click"},{selector:".iweb-slider-sheet-body button",action:"click"},{selector:'svg[class*="iconDownarrow"]',action:"click"},{selector:'input[placeholder="Nombre"], input[placeholder="First Name"]',value:"firstName",action:"write",options:{waitBefore:1e3}},{selector:'input[placeholder="Apellidos"], input[placeholder="Last Name"]',value:"lastName",action:"write"},{selector:'input[placeholder="000-000-000"]',value:"phoneNumber",action:"type"},{selector:'input[placeholder="Calle y nmero"], input[placeholder="Street and number"]',value:t=>{var e,n;return`${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].address} ${null===(n=t.shippingAddresses)||void 0===n?void 0:n[0].secondAddress}`},action:"write"},{selector:'input[placeholder*="Piso"]',value:t=>{var e;return`${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].secondAddress}`},action:"write"},{selector:'input[placeholder*="12345"]',value:t=>{var e;return`${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].zipCode}`},action:"write"},{selector:".iweb-cascader-select-selector",action:t=>{return e=void 0,n=void 0,o=function*(){return t.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0})),Promise.resolve()},new((i=void 0)||(i=Promise))((function(t,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}));var e,n,i,o}},{selector:t=>{var e;return`li[title*="${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].province}"]`},action:"click"},{selector:t=>{var e;return`li[title="${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].city}"][data-path-key*="RC"]`},action:"click"},{selector:".iweb-checkbox-icon",action:"click"},{selector:".iweb-slider-sheet-body button",action:"click"},{selector:".iweb-slider-sheet-footer button.btnSave-Bk6Hq",action:"click",options:{timeout:1e4}},{selector:".addCard--hv0y9RS .cardItem--_vDgBaq",action:"click"},{selector:'input[name="creditCard"]',value:"cardInformation.number",action:"type"},{selector:'input[name="cardName"]',value:"cardInformation.holder",action:"write"},{selector:'input[name="expiryDate"]',value:t=>{var e,n,i,o,r;return 1===(null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString().length)?`0${null===(n=t.cardInformation)||void 0===n?void 0:n.expMonth}${null===(i=t.cardInformation)||void 0===i?void 0:i.expYear}`:`${null===(o=t.cardInformation)||void 0===o?void 0:o.expMonth}${null===(r=t.cardInformation)||void 0===r?void 0:r.expYear}`},action:"write"},{selector:'input[name="cvv"]',value:"cardInformation.cvv",action:"write"},{selector:'button[class="iweb-button iweb-button-primary confirm--Hz3vcCl confirm--Hz3vcCl"]',action:"click"},{selector:"button .iweb-button-mask",action:"click"}],sn={miravia:an,aliexpress:[{selector:".comet-btn.comet-btn-link.pl-address-item__new-btn",action:"click"},{value:t=>`${t.firstName} ${t.lastName}`,selector:'*[placeholder="Nombre de contacto*" i]',action:"write"},{value:t=>t.phoneNumber,selector:'*[placeholder="Telfono mvil*" i]',action:"write"},{value:"shippingAddresses.0.zipCode",selector:'*[placeholder="Buscar por cdigo postal, calle, o direccin" i]',action:"write"},{selector:t=>{var e;return`//*[contains(@title, '${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].zipCode}')]`},action:"click"},{value:"shippingAddresses.0.zipCode",selector:'input[placeholder="Cdigo postal*" i]',action:"waitForValue"},{value:"shippingAddresses.0.address",selector:'*[placeholder="Calle, casa/apartamento*" i]',action:"write"},{value:"shippingAddresses.0.secondAddress",selector:'*[placeholder="Apartamento, suite, unidad, etc." i]',action:"write",options:{waitValue:!0}},{selector:".comet-btn.comet-btn-primary.comet-btn-large.form-item-button",action:"click",options:{waitAfter:3e3}},{selector:'[data-pl="payment-root"] [data-pl="payment-method-title"]',action:"click"},{action:"click",selector:".credit-card--card-brand-icon--2bUnkAV"},{value:"cardInformation.number",selector:"#cardNum",action:"write"},{value:"cardInformation.holder",selector:"#cardHolder",action:"write"},{value:"cardInformation.cvv",selector:"#cvv",action:"write"},{selector:'input[label="MM"]',action:"click"},{selector:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),`li[label="${n}"]`},action:"click"},{selector:'input[label="YY"]',action:"click"},{selector:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),`li[label="${n}"]`},action:"click"},{selector:'input[label="YY"]',value:t=>{var e;const n=null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString();return 1===(null==n?void 0:n.toString().length)?"0"+n:null!=n?n:""},action:"waitForValue"},{selector:".comet-drawer-body #payment-botton-section > button",action:"click"},{selector:".comet-btn.comet-btn-primary.comet-btn-large.pl-order-toal-container__btn",action:"click"}],myprotein:[{value:t=>`${t.firstName} ${t.lastName}`,selector:'input[name="deliveryAddress.addressee"]',action:"write"},{value:"shippingAddresses.0.zipCode",selector:'input[name="deliveryAddress.postCode"]',action:"write"},{value:t=>{var e,n;return`${null===(n=null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].address)||void 0===n?void 0:n.replace(/^\D+/g,"")}`},selector:'input[name="deliveryAddress.nameNumber"]',action:"write"},{value:t=>{var e,n;return`${null===(n=null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].address)||void 0===n?void 0:n.replace(/[0-9]/g,"")}`},selector:'input[name="deliveryAddress.streetName"]',action:"write"},{value:"shippingAddresses.0.secondAddress",selector:'input[name="deliveryAddress.addressLine2"]',action:"write"},{value:"shippingAddresses.0.city",selector:'input[name="deliveryAddress.townCity"]',action:"write"},{value:"shippingAddresses.0.province",selector:'input[name="deliveryAddress.county"]',action:"write"},{value:t=>{var e,n;return(null===(e=t.countryNumberCode)||void 0===e?void 0:e.includes("+"))?`${null===(n=t.countryNumberCode)||void 0===n?void 0:n.slice(1)}${t.phoneNumber}`:`${t.countryNumberCode}${t.phoneNumber}`},selector:'input[name="deliveryAddress.contactNumber"]',action:"write"},{value:"cardInformation.number",selector:'input[name="paymentCard.creditCardNumber"]',action:"write"},{value:"cardInformation.holder",selector:'input[name="paymentCard.nameOnCard"]',action:"write"},{value:"cardInformation.cvv",selector:'input[name="paymentCard.cv2"]',action:"write"},{value:t=>{var e,n;const i=null!==(n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString())&&void 0!==n?n:"";return 1===(null==i?void 0:i.toString().length)?"0"+i:i},selector:"#expiration-month",action:"write"},{value:t=>{var e,n;return"20"+(null!==(n=null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString())&&void 0!==n?n:"")},selector:"#expiration-year",action:"write"},{selector:"#SubmitButton",action:"click"}],fnac:[{value:"lastName",selector:"#lastName",action:"write"},{value:"firstName",selector:"#firstName",action:"write"},{selector:t=>`[class*="addressForm__field-gender"] input[value="${"M"===t.gender?"2":"3"}"]`,action:"click"},{value:"shippingAddresses.0.address",selector:"#address",action:"type"},{action:"click",selector:'[class^="addressForm__field-more__icon"]',options:{optional:!0}},{value:"shippingAddresses.0.secondAddress",action:"write",selector:"#floor",options:{timeout:1e3,optional:!0}},{selector:"#zipCode",value:"shippingAddresses.0.zipCode",action:"write"},{selector:"#city",value:"shippingAddresses.0.city",action:"write"},{selector:'select[name="state"]',action:"write",value:t=>{var e,n,i;return null!==(i=null===(n=null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].province)||void 0===n?void 0:n.toUpperCase())&&void 0!==i?i:""}},{selector:'input[name="taxIdNumber"]',action:"write",value:"nif"},{selector:"#phone",value:"phoneNumber",action:"write"},{selector:"#addressName",value:()=>"Qoala Autofill",action:"write"},{selector:'button[type="submit"]',action:"click",options:{waitAfter:3e3}},{selector:'button[data-testid="basketSubmitBtn"]',action:"click",options:{timeout:1e4}},{selector:'input[id="Tarjeta bancaria"]',action:"click"},{selector:"#cardNumber",value:"cardInformation.number",action:"write"},{action:"type",value:t=>{var e,n,i,o,r;return 1===(null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString().length)?`0${null===(n=t.cardInformation)||void 0===n?void 0:n.expMonth}${null===(i=t.cardInformation)||void 0===i?void 0:i.expYear}`:`${null===(o=t.cardInformation)||void 0===o?void 0:o.expMonth}${null===(r=t.cardInformation)||void 0===r?void 0:r.expYear}`},selector:"#expiry"},{action:"type",value:"cardInformation.cvv",selector:"#cvc"},{action:"write",value:"cardInformation.holder",selector:"#name"},{action:"click",selector:'button[type="submit"]'}],shein:[{selector:"span.manual-btn.mb-20",action:"click"},{selector:'[rule_field_id="2027"] input',action:"type",value:"firstName"},{selector:'[rule_field_id="2028"] input',action:"type",value:"lastName"},{selector:'[rule_field_id="2029"] input',action:"type",value:"phoneNumber"},{selector:'[rule_field_id="2031"] textarea',action:"type",value:"shippingAddresses.0.address"},{selector:'[rule_field_id="2032"] textarea',action:"type",value:"shippingAddresses.0.secondAddress"},{selector:'[rule_field_id="2033"] input',action:"type",value:"shippingAddresses.0.zipCode"},{selector:"button.save",action:"click",options:{waitBefore:1500,waitAfter:2e3}},{selector:'div[type="routepay-card"] span',action:"click"},{selector:".check-btn button",action:"click",options:{waitBefore:1e3}},{selector:"#cardInput",value:"cardInformation.number",action:"type"},{selector:'input[placeholder="CVV/CVC/CID"]',value:"cardInformation.cvv",action:"type"},{selector:".data-select .select-item:nth-child(1) select",value:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),null!=n?n:""},action:"write"},{selector:".data-select .select-item:nth-child(2) select",value:t=>{var e;return`20${null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString()}`},action:"write"},{selector:".check-btn button.she-btn-black.she-btn-xl",action:"click",options:{waitBefore:1e3}}],zara:[{selector:'form#address-form input[name="firstName"]',action:"write",value:"firstName"},{selector:'form#address-form input[name="lastName"]',action:"write",value:"lastName"},{selector:'form#address-form select[name="countryCode"]',action:"write",value:"shippingAddresses.0.countryCode"},{selector:'form#address-form input[name="addressLines[0]"]',action:"write",value:"shippingAddresses.0.address"},{selector:'form#address-form input[name="addressLines[1]"]',action:"write",value:"shippingAddresses.0.secondAddress"},{selector:'form#address-form input[name="zipCode"]',action:"write",value:"shippingAddresses.0.zipCode"},{selector:'form#address-form input[name="city"]',action:"write",value:"shippingAddresses.0.city"},{selector:'form#address-form select[name="stateCode"]',action:"select",value:t=>{var e,n,i;return null!==(i=null===(n=null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].province)||void 0===n?void 0:n.toUpperCase())&&void 0!==i?i:""}},{selector:'form#address-form input[name="phones[0].countryCode"]',action:"write",value:({countryNumberCode:t})=>{var e;return null!==(e=null==t?void 0:t.toString().slice(1))&&void 0!==e?e:""}},{selector:'form#address-form input[name="phones[0].subscriberNumber"]',action:"write",value:"phoneNumber"},{selector:'form#address-form input[name="email"]',action:"write",value:"email",options:{optional:!0,timeout:500}},{selector:".layout-shop-footer__continue button",action:"click",options:{waitAfter:3e3}},{selector:".layout-shop-footer__continue button",action:"click"},{selector:t=>{var e;return"4"===(null===(e=t.cardInformation)||void 0===e?void 0:e.number[0])?"#\\31 001":"#\\31 002"},action:"click"},{selector:".layout-shop-footer__continue button",action:"click"},{selector:'input[name="cvv2"]',action:"write",value:"cardInformation.cvv"},{selector:'input[name="pan"]',action:"write",value:"cardInformation.number"},{selector:'input[name="holder"]',action:"write",value:"cardInformation.holder"},{selector:'select[name="month"]',action:"write",value:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),null!=n?n:""}},{selector:'select[name="year"]',action:"write",value:t=>{var e;return`20${null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString()}`}},{selector:".layout-shop-footer__continue button",action:"click",options:{waitAfter:3e3}},{selector:'input[name="terms"]',action:"click",value:()=>"true"},{selector:".layout-shop-footer__continue button",action:"click"}],zooplus:[{selector:'div[aria-hidden="false"][class="section__input v3-shadowBox"] #shippingCustomerFirstName',action:"write",value:"firstName"},{selector:"#shippingCustomerLastName",action:"write",value:"lastName"},{selector:t=>{var e;return`[data-country*="\\"iso3166Name\\":\\"${null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].countryCode}\\""]`},action:"click"},{selector:"#someCodeShp",action:"write",value:"shippingAddresses.0.zipCode"},{selector:"#someCityShp",action:"write",value:"shippingAddresses.0.city"},{selector:"#someStrShp",action:"write",value:"shippingAddresses.0.address"},{selector:"#info",action:"write",value:"shippingAddresses.0.secondAddress"},{selector:"#shippingPhoneNumber",action:"type",value:t=>`${t.countryNumberCode}${t.phoneNumber}`},{selector:"#js-shipping__section  .v3-btn.v3-btn--main.full__width__btn",action:"click"},{selector:"button.save",action:"click",options:{optional:!0,timeout:3e3}},{selector:'label[for="creditCard"]',action:"click",options:{waitAfter:1500}},{selector:'div[aria-hidden="false"][class="section__input v3-shadowBox"] #paymentForm input[name="cardNumber"]',value:"cardInformation.number",action:"write",options:{completeIfPresent:!0}},{selector:"#paymentForm #card\\.cardHolderName",value:"cardInformation.holder",action:"write"},{selector:"#paymentForm #card\\.cardHolderName",value:"cardInformation.holder",action:"write"},{selector:"#card\\.expiryMonth",action:"select",value:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),null!=n?n:""}},{selector:"#card\\.expiryYear",action:"select",value:t=>{var e;return`20${null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString()}`}},{selector:"#card\\.cardCode",action:"write",value:"cardInformation.cvv"},{selector:"#paymentForm .button__group button",action:"click"},{selector:"#js-account__section div.button__group button",action:"click"},{selector:"form button#makeTheOrder",action:"click"}],bershka:[{selector:".action-edit.table-cell span.sc-title-link",action:"click",options:{waitAfter:500,optional:!0}},{selector:'input[name="name"]',action:"write",value:t=>t.firstName,options:{optional:!0}},{selector:'input[name="name"].ng-pristine.ng-untouched.ng-empty.ng-invalid.ng-invalid-required.ng-valid-maxlength.ng-valid-latin-chars',action:"write",value:t=>t.firstName,options:{optional:!0}},{selector:'input[name="surname"]',action:"write",value:t=>t.lastName},{selector:'input[name="email"]',action:"write",value:t=>t.email},{selector:'input[name="phone"]',action:"write",value:t=>t.phoneNumber},{selector:'input[name="address"]',action:"write",value:"shippingAddresses.0.address"},{selector:'input[name="address2"]',action:"write",value:"shippingAddresses.0.secondAddress"},{selector:'input[name="zipCode"]',action:"write",value:"shippingAddresses.0.zipCode"},{selector:'select[name="province"]',action:"select",value:t=>{var e;return null===(e=t.shippingAddresses)||void 0===e?void 0:e[0].province.toUpperCase()}},{selector:'input[name="city"]',action:"write",value:"shippingAddresses.0.city"},{selector:"li.check.medium-margin-top.same-address-check",action:"click",options:{waitAfter:500}},{selector:'input[name="privacyPolicy"]',action:"click",options:{waitAfter:1e3}},{selector:"div.cta-checkout-action.cta-checkout-pay button",action:"click",options:{waitBefore:1e3}},{selector:'button[title="close"]',action:"click",options:{waitBefore:1e3}},{selector:"div.cta-checkout-action.cta-checkout-pay button",action:"click",options:{waitAfter:2e3}},{selector:"div.payment-info.payment-1-info",action:"click",options:{waitBefore:1e3}},{selector:'input[name="number"]',action:"type",value:"cardInformation.number"},{selector:'select[name="month"]',action:"select",value:t=>{var e;let n=null===(e=t.cardInformation)||void 0===e?void 0:e.expMonth.toString();return 1===(null==n?void 0:n.toString().length)&&(n="0"+n),null!=n?n:""}},{selector:'select[name="year"]',action:"select",value:t=>{var e;return`20${null===(e=t.cardInformation)||void 0===e?void 0:e.expYear.toString()}`}},{selector:'input[name="cvv2"]',action:"type",value:"cardInformation.cvv"},{selector:'input[name="holder"]',action:"click",options:{waitAfter:500}},{selector:'input[name="holder"]',action:"type",value:"cardInformation.holder"},{selector:'input[name="privacyPolicy"]',action:"click",options:{waitAfter:1e3}},{selector:"span.cta-checkout-text",action:"click"}],primor:[{selector:"a.shipping-step__new-link.link",action:"click",options:{optional:!0}},{selector:'div[name="shippingAddress.firstname"]',action:"click"},{selector:'input[name="firstname"]',action:"write",value:"firstName"},{selector:'input[name="lastname"]',action:"write",value:"lastName"},{selector:'input[name="street[0]"]',action:"write",value:"shippingAddresses.0.address"},{selector:'input[name="street[1]"]',action:"write",value:"shippingAddresses.0.secondAddress"},{selector:'select[name="region_id"]',action:"select",value:"shippingAddresses.0.province"},{selector:'input[name="city"]',action:"write",value:"shippingAddresses.0.city"},{selector:'input[name="postcode"]',action:"write",value:"shippingAddresses.0.zipCode"},{selector:'input[name="telephone"]',action:"write",value:"phoneNumber"},{selector:"#shipping-save-in-address-book",action:"click",options:{optional:!0}},{selector:'button[data-bind="click: setShippingInformation"]',action:"click"}]};function cn(t){return ft(ft({type:It},t),{toJSON:function(){t.onDone,t.onError;var e,n=pt(t,["onDone","onError"]);return ft(ft({},n),{type:It,src:(e=t.src,"string"==typeof e?{type:e,toString:function(){return e}}:e)})}})}var ln="",un="*",dn={},hn=function(t){return"#"===t[0]},fn=function(){function t(e,n,i,o){void 0===i&&(i="context"in e?e.context:void 0);var r,a=this;this.config=e,this._context=i,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},n),this.parent=null==o?void 0:o.parent,this.key=this.config.key||(null==o?void 0:o.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:"."),this.id=this.config.id||mt([this.machine.key],yt(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(r=this.config.schema)&&void 0!==r?r:{},this.description=this.config.description,Mt||Zt(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?qt(this.config.states,(function(e,n){var i,o=new t(e,{},void 0,{parent:a,key:n});return Object.assign(a.idMap,ft(((i={})[o.id]=o,i),o.idMap)),o})):dn;var s=0;!function t(e){var n,i;e.order=s++;try{for(var o=vt(ve(e)),r=o.next();!r.done;r=o.next())t(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some((function(t){return t.event===ln})):ln in this.config.on),this.strict=!!this.config.strict,this.onEntry=Kt(this.config.entry||this.config.onEntry).map((function(t){return Ce(t)})),this.onExit=Kt(this.config.exit||this.config.onExit).map((function(t){return Ce(t)})),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=Kt(this.config.invoke).map((function(t,e){var n,i;if(re(t)){var o=he(a.id,e);return a.machine.options.services=ft(((n={})[o]=t,n),a.machine.options.services),cn({src:o,id:o})}if(ne(t.src))return o=t.id||he(a.id,e),cn(ft(ft({},t),{id:o,src:t.src}));if(re(t.src)||ee(t.src))return o=t.id||he(a.id,e),a.machine.options.services=ft(((i={})[o]=t.src,i),a.machine.options.services),cn(ft(ft({id:o},t),{src:o}));var r=t.src;return cn(ft(ft({id:he(a.id,e)},t),{src:r}))})),this.activities=Kt(this.config.activities).concat(this.invoke).map((function(t){return Pe(t)})),this.transition=this.transition.bind(this),this.tags=Kt(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||me(this).forEach((function(t){return t.on}))},t.prototype.withConfig=function(e,n){var i=this.options,o=i.actions,r=i.activities,a=i.guards,s=i.services,c=i.delays;return new t(this.config,{actions:ft(ft({},o),e.actions),activities:ft(ft({},r),e.activities),guards:ft(ft({},a),e.guards),services:ft(ft({},s),e.services),delays:ft(ft({},c),e.delays)},null!=n?n:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return ee(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:qt(this.states,(function(t){return t.definition})),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce((function(t,e){return t[e.eventType]=t[e.eventType]||[],t[e.eventType].push(e),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===ln,n=this.transitions.filter((function(n){var i=n.eventType===t;return e?i:i||n.eventType===un}));return this.__cache.candidates[t]=n,n},t.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var n=function(e,n){var i=Be(ee(e)?"".concat(t.id,":delay[").concat(n,"]"):e,t.id);return t.onEntry.push(Oe(i,{delay:e})),t.onExit.push(Re(i)),i};return(te(e)?e.map((function(t,e){var i=n(t.delay,e);return ft(ft({},t),{event:i})})):Ht(Object.keys(e).map((function(t,i){var o=e[t],r=ne(o)?{target:o}:o,a=isNaN(+t)?t:+t,s=n(a,i);return Kt(r).map((function(t){return ft(ft({},t),{event:s,delay:a})}))})))).map((function(e){var n=e.delay;return ft(ft({},t.formatTransition(e)),{delay:n})}))},t.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var i=t instanceof ze?t.value:Ft(t,this.delimiter);if(ne(i)){var o=this.getStateNode(i).initial;return void 0!==o?this.getStateNodes(((e={})[i]=o,e)):[this,this.states[i]]}var r=Object.keys(i),a=[this];return a.push.apply(a,mt([],yt(Ht(r.map((function(t){return n.getStateNode(t).getStateNodes(i[t])})))),!1)),a},t.prototype.handles=function(t){var e=$t(t);return this.events.includes(e)},t.prototype.resolveState=function(t){var e=t instanceof ze?t:ze.create(t),n=Array.from(ge([],this.getStateNodes(e.value)));return new ze(ft(ft({},e),{value:this.resolve(e.value),configuration:n,done:Ee(n,this),tags:Se(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(t,e,n){var i=this.getStateNode(t).next(e,n);return i&&i.transitions.length?i:this.next(e,n)},t.prototype.transitionCompoundNode=function(t,e,n){var i=Object.keys(t),o=this.getStateNode(i[0])._transition(t[i[0]],e,n);return o&&o.transitions.length?o:this.next(e,n)},t.prototype.transitionParallelNode=function(t,e,n){var i,o,r={};try{for(var a=vt(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,l=t[c];if(l){var u=this.getStateNode(c)._transition(l,e,n);u&&(r[c]=u)}}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}var d=Object.keys(r).map((function(t){return r[t]})),h=Ht(d.map((function(t){return t.transitions})));if(!d.some((function(t){return t.transitions.length>0})))return this.next(e,n);var f=Ht(Object.keys(r).map((function(t){return r[t].configuration})));return{transitions:h,exitSet:Ht(d.map((function(t){return t.exitSet}))),configuration:f,source:e,actions:Ht(Object.keys(r).map((function(t){return r[t].actions})))}},t.prototype._transition=function(t,e,n){return ne(t)?this.transitionLeafNode(t,e,n):1===Object.keys(t).length?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},t.prototype.getTransitionData=function(t,e){return this._transition(t.value,t,se(e))},t.prototype.next=function(t,e){var n,i,o,r=this,a=e.name,s=[],c=[];try{for(var l=vt(this.getCandidates(a)),u=l.next();!u.done;u=l.next()){var d=u.value,h=d.cond,f=d.in,p=t.context,v=!f||(ne(f)&&hn(f)?t.matches(Ft(this.getStateNodeById(f).path,this.delimiter)):Bt(Ft(f,this.delimiter),zt(this.path.slice(0,-2))(t.value))),y=!1;try{y=!h||le(this.machine,h,p,e,t)}catch(t){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,"':\n").concat(t.message))}if(y&&v){void 0!==d.target&&(c=d.target),s.push.apply(s,mt([],yt(d.actions),!1)),o=d;break}}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}if(o){if(!c.length)return{transitions:[o],exitSet:[],configuration:t.value?[this]:[],source:t,actions:s};var m=Ht(c.map((function(e){return r.getRelativeStateNodes(e,t.historyValue)})));return{transitions:[o],exitSet:o.internal?[]:Ht(c.map((function(t){return r.getPotentiallyReenteringNodes(t)}))),configuration:m,source:t,actions:s}}},t.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var e=[],n=this,i=t;n&&n!==i;)e.push(n),n=n.parent;return n!==i?[]:(e.push(i),e)},t.prototype.getActions=function(t,e,n,i,o,r,a){var s,c,l,u,d=this,h=r?ge([],this.getStateNodes(r.value)):[],f=new Set;try{for(var p=vt(Array.from(t).sort((function(t,e){return t.order-e.order}))),v=p.next();!v.done;v=p.next())(!xe(h,g=v.value)||xe(n.exitSet,g)||g.parent&&f.has(g.parent))&&f.add(g)}catch(t){s={error:t}}finally{try{v&&!v.done&&(c=p.return)&&c.call(p)}finally{if(s)throw s.error}}try{for(var y=vt(h),m=y.next();!m.done;m=y.next()){var g;xe(t,g=m.value)&&!xe(n.exitSet,g.parent)||n.exitSet.push(g)}}catch(t){l={error:t}}finally{try{m&&!m.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}n.exitSet.sort((function(t,e){return e.order-t.order}));var w=Array.from(f).sort((function(t,e){return t.order-e.order})),b=new Set(n.exitSet),_=Ht(w.map((function(t){var e=[];if("final"!==t.type)return e;var r=t.parent;if(!r.parent)return e;e.push($e(t.id,t.doneData),$e(r.id,t.doneData?Jt(t.doneData,i,o):void 0));var a=r.parent;return"parallel"===a.type&&ye(a).every((function(t){return Ee(n.configuration,t)}))&&e.push($e(a.id)),e}))),x=w.map((function(t){var e=t.onEntry,n=t.activities.map((function(t){return Le(t)}));return{type:"entry",actions:Te(a?mt(mt([],yt(e),!1),yt(n),!1):mt(mt([],yt(n),!1),yt(e),!1),d.machine.options.actions)}})).concat({type:"state_done",actions:_.map((function(t){return Ie(t)}))}),E=Array.from(b).map((function(t){return{type:"exit",actions:Te(mt(mt([],yt(t.onExit),!1),yt(t.activities.map((function(t){return De(t)}))),!1),d.machine.options.actions)}})).concat({type:"transition",actions:Te(n.actions,this.machine.options.actions)}).concat(x);if(e){var S=Te(Ht(mt([],yt(t),!1).sort((function(t,e){return e.order-t.order})).map((function(t){return t.onExit}))),this.machine.options.actions).filter((function(t){return!fe(t)}));return E.concat({type:"stop",actions:S})}return E},t.prototype.transition=function(t,e,n,i){void 0===t&&(t=this.initialState);var o,r,a=se(e);if(t instanceof ze)o=void 0===n?t:this.resolveState(ze.from(t,n));else{var s=ne(t)?this.resolve(Ut(this.getResolvedPath(t))):this.resolve(t),c=null!=n?n:this.machine.context;o=this.resolveState(ze.from(s,c))}if(!Mt&&a.name===un)throw new Error("An event cannot have the wildcard type ('".concat(un,"')"));if(this.strict&&!this.events.includes(a.name)&&(r=a.name,!/^(done|error)\./.test(r)))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(a.name,"'"));var l=this._transition(o.value,o,a)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},u=ge([],this.getStateNodes(o.value)),d=l.configuration.length?ge(u,l.configuration):u;return l.configuration=mt([],yt(d),!1),this.resolveTransition(l,o,o.context,i,a)},t.prototype.resolveRaisedTransition=function(t,e,n,i){var o,r=t.actions;return(t=this.transition(t,e,void 0,i))._event=n,t.event=n.data,(o=t.actions).unshift.apply(o,mt([],yt(r),!1)),t},t.prototype.resolveTransition=function(t,e,n,i,o){var r,a,s,c,l=this;void 0===o&&(o=ke);var u=t.configuration,d=!e||t.transitions.length>0,h=d?t.configuration:e?e.configuration:[],f=Ee(h,this),p=d?_e(this.machine,u):void 0,v=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,y=this.getActions(new Set(h),f,t,n,o,e,i),m=e?ft({},e.activities):{};try{for(var g=vt(y),w=g.next();!w.done;w=g.next()){var b=w.value;try{for(var _=(s=void 0,vt(b.actions)),x=_.next();!x.done;x=_.next()){var E=x.value;E.type===_t?m[E.activity.id||E.activity.type]=E:E.type===xt&&(m[E.activity.id||E.activity.type]=!1)}}catch(t){s={error:t}}finally{try{x&&!x.done&&(c=_.return)&&c.call(_)}finally{if(s)throw s.error}}}}catch(t){r={error:t}}finally{try{w&&!w.done&&(a=g.return)&&a.call(g)}finally{if(r)throw r.error}}var S,k,A=yt(qe(this,e,n,o,y,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),C=A[0],T=A[1],P=yt(function(t,e){var n,i,o=yt([[],[]],2),r=o[0],a=o[1];try{for(var s=vt(t),c=s.next();!c.done;c=s.next()){var l=c.value;e(l)?r.push(l):a.push(l)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return[r,a]}(C,fe),2),I=P[0],O=P[1],N=C.filter((function(t){var e;return t.type===_t&&(null===(e=t.activity)||void 0===e?void 0:e.type)===It})),R=N.reduce((function(t,e){return t[e.activity.id]=function(t,e,n,i){var o,r=ue(t.src),a=null===(o=null==e?void 0:e.options.services)||void 0===o?void 0:o[r.type],s=t.data?Jt(t.data,n,i):void 0,c=a?Xe(a,t.id,s):Je(t.id);return c.meta=t,c}(e.activity,l.machine,T,o),t}),e?ft({},e.children):{}),L=new ze({value:p||e.value,context:T,_event:o,_sessionid:e?e._sessionid:null,historyValue:p?v?(S=v,k=p,{current:k,states:Wt(S,k)}):void 0:e?e.historyValue:void 0,history:!p||t.source?e:void 0,actions:p?O:[],activities:p?m:e?e.activities:{},events:[],configuration:h,transitions:t.transitions,children:R,done:f,tags:Se(h),machine:this}),D=n!==T;L.changed=o.name===Rt||D;var M=L.history;M&&delete M.history;var B=!f&&(this._transient||u.some((function(t){return t._transient})));if(!(d||B&&o.name!==ln))return L;var $=L;if(!f)for(B&&($=this.resolveRaisedTransition($,{type:At},o,i));I.length;){var j=I.shift();$=this.resolveRaisedTransition($,j._event,o,i)}var F=$.changed||(M?!!$.actions.length||D||typeof M.value!=typeof $.value||!Ve($.value,M.value):void 0);return $.changed=F,$.history=M,$},t.prototype.getStateNode=function(t){if(hn(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},t.prototype.getStateNodeById=function(t){var e=hn(t)?t.slice(1):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&hn(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var e=jt(t,this.delimiter).slice(),n=this;e.length;){var i=e.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||dn;switch(this.type){case"parallel":return qt(this.initialStateValue,(function(e,i){return e?n.getStateNode(i).resolve(t[i]||e):dn}));case"compound":if(ne(t)){var i=this.getStateNode(t);return"parallel"===i.type||"compound"===i.type?((e={})[t]=i.initialStateValue,e):t}return Object.keys(t).length?qt(t,(function(t,e){return t?n.getStateNode(e).resolve(t):dn})):this.initialStateValue||{};default:return t||dn}},t.prototype.getResolvedPath=function(t){if(hn(t)){var e=this.machine.idMap[t.slice(1)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return jt(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t,e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)e=Vt(this.states,(function(t){return t.initialStateValue||dn}),(function(t){return!("history"===t.type)}));else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=pe(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(t,e){this._init();var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,null!=e?e:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=ne(e.target)&&hn(e.target)?Ut(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(t,e,n){return void 0===n&&(n=!0),n?"history"===t.type?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;return pe(this)?[this]:"compound"!==this.type||this.initial?Ht(Gt(this.initialStateValue).map((function(e){return t.getFromRelativePath(e)}))):(Mt||Zt(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this])},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=yt(t),n=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var o=this.getStateNode(n);if("history"===o.type)return o.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Vt(this.states,(function(e,n){if(!t)return e.historyValue();var i=ne(t)?void 0:t[n];return e.historyValue(i||e.initialStateValue)}),(function(t){return!t.history}))}},t.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var n=this.parent;if(!t){var i=this.target;return i?Ht(Gt(i).map((function(t){return n.getFromRelativePath(t)}))):n.initialStateNodes}var o,r=(o=n.path,"states",function(t){var e,n,i=t;try{for(var r=vt(o),a=r.next();!a.done;a=r.next()){var s=a.value;i=i.states[s]}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i})(t).current;return ne(r)?[n.getStateNode(r)]:Ht(Gt(r).map((function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]})))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,e=Ht(Object.keys(this.states).map((function(e){return t.states[e].stateIds})));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var t,e,n,i;if(this.__cache.events)return this.__cache.events;var o=this.states,r=new Set(this.ownEvents);if(o)try{for(var a=vt(Object.keys(o)),s=a.next();!s.done;s=a.next()){var c=o[s.value];if(c.states)try{for(var l=(n=void 0,vt(c.events)),u=l.next();!u.done;u=l.next()){var d=u.value;r.add("".concat(d))}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter((function(t){return!(!t.target&&!t.actions.length&&t.internal)})).map((function(t){return t.eventType})));return Array.from(t)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(t){var e=this;if(void 0!==t)return t.map((function(t){if(!ne(t))return t;var n=t[0]===e.delimiter;if(n&&!e.parent)return e.getStateNodeByPath(t.slice(1));var i=n?e.key+t:t;if(!e.parent)return e.getStateNodeByPath(i);try{return e.parent.getStateNodeByPath(i)}catch(t){throw new Error("Invalid transition definition for state node '".concat(e.id,"':\n").concat(t.message))}}))},t.prototype.formatTransition=function(t){var e=this,n=function(t){if(void 0!==t&&""!==t)return Kt(t)}(t.target),i="internal"in t?t.internal:!n||n.some((function(t){return ne(t)&&t[0]===e.delimiter})),o=this.machine.options.guards,r=this.resolveTarget(n),a=ft(ft({},t),{actions:Te(Kt(t.actions)),cond:ie(t.cond,o),target:r,source:this,internal:i,eventType:t.event,toJSON:function(){return ft(ft({},a),{target:a.target?a.target.map((function(t){return"#".concat(t.id)})):void 0,source:"#".concat(e.id)})}});return a},t.prototype.formatTransitions=function(){var t,e,n,i=this;if(this.config.on)if(Array.isArray(this.config.on))n=this.config.on;else{var o=this.config.on,r=o[un],a=void 0===r?[]:r,s=pt(o,["*"]);n=Ht(Object.keys(s).map((function(t){Mt||t!==ln||Zt(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(i.id,'".'));var e=ce(t,s[t]);return Mt||function(t,e,n){var i=n.slice(0,-1).some((function(t){return!("cond"in t)&&!("in"in t)&&(ne(t.target)||re(t.target))})),o=e===ln?"the transient event":"event '".concat(e,"'");Zt(!i,"One or more transitions for ".concat(o," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")}(i,t,e),e})).concat(ce(un,a)))}else n=[];var c=this.config.always?ce("",this.config.always):[],l=this.config.onDone?ce(String($e(this.id)),this.config.onDone):[];Mt||Zt(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var u=Ht(this.invoke.map((function(t){var e=[];return t.onDone&&e.push.apply(e,mt([],yt(ce(String(je(t.id)),t.onDone)),!1)),t.onError&&e.push.apply(e,mt([],yt(ce(String(Fe(t.id)),t.onError)),!1)),e}))),d=this.after,h=Ht(mt(mt(mt(mt([],yt(l),!1),yt(u),!1),yt(n),!1),yt(c),!1).map((function(t){return Kt(t).map((function(t){return i.formatTransition(t)}))})));try{for(var f=vt(d),p=f.next();!p.done;p=f.next()){var v=p.value;h.push(v)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=f.return)&&e.call(f)}finally{if(t)throw t.error}}return h},t}(),pn=!1,vn=Me;function yn(t,e){return n=this,i=void 0,r=function*(){if(t.value=e,!t.dispatchEvent(new Event("change",{bubbles:!0})))throw new Error(`Could not set value ${e} on node ${t}`)},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function s(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}const mn={click:function(t){return e=this,n=void 0,o=function*(){if(!t.dispatchEvent(new MouseEvent("click",{bubbles:!0})))throw new Error(`Could not click on node ${t}`)},new((i=void 0)||(i=Promise))((function(t,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}));var e,n,i,o},select:function(t,e,n=((t,e)=>t.innerHTML.includes(e))){return i=this,o=void 0,a=function*(){const i=t.options;for(let o=0;o<i.length;o++)if(n(i[o],e))return yn(t,i[o].value);throw new Error(`Could not set value ${e} on select ${t}`)},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a},type:function(t,e,n=50){return i=this,o=void 0,a=function*(){t.focus();for(const i of e){const e=new KeyboardEvent("keydown",{key:i,bubbles:!0}),o=new InputEvent("input",{data:i,bubbles:!0}),r=new KeyboardEvent("keyup",{key:i,bubbles:!0});t.value+=i,t.dispatchEvent(e),t.dispatchEvent(o),t.dispatchEvent(r),yield new Promise((t=>setTimeout(t,n)))}const i=new Event("change",{bubbles:!0});t.dispatchEvent(i)},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a},write:yn,waitForValue:_n};class gn extends Error{constructor(t){super(t),this.name="TimeoutError"}}var wn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const bn={waitAfter:0,waitBefore:0,optional:!1,timeout:5e3,completeIfPresent:!0,waitValue:!1,attributes:!1};function _n(t,e,n=5e3){return wn(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{t.value===e&&i();const r=new MutationObserver((function(t){t.forEach((function(t){t.target instanceof HTMLInputElement&&"attributes"===t.type&&"value"===t.attributeName&&t.target.value===e&&(r.disconnect(),i())}))}));r.observe(t,{attributes:!0,attributeFilter:["value"]}),setTimeout((()=>{r.disconnect(),o(new Error(`Element ${t.id} not filled with value ${e} within ${n}ms`))}),n)}))}))}function xn(t){return/^\/\//.test(t)?"xpath":"selector"}function En(){const t=document.getElementById("greyBg");t&&t.remove()}function Sn(t){return wn(this,void 0,void 0,(function*(){return new Promise((e=>setTimeout(e,t)))}))}var kn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const{stop:An}=e;function Cn(t,e,n){return i={predictableActionArguments:!0,id:"checkout",initial:"autofill",schema:{context:{},events:{}},context:{shopper:e,sequence:t,advertiser:n,index:0},entry:({advertiser:t,shopper:e})=>kn(this,void 0,void 0,(function*(){!function(){const t=document.createElement("div");t.id="greyBg",t.style.backgroundColor="rgba(0, 0, 0, 0.55)",t.style.width="100%",t.style.height="100%",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",t.style.zIndex="20000",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.flexDirection="column";const e=document.createElement("p"),n=document.createTextNode("Realizando el Checkout por ti");e.appendChild(n),e.id="textSpinner",e.style.fontSize="14px",e.style.color="#ffffff",e.style.fontWeight="600",e.style.marginTop="10px",e.style.width="120px",e.style.textAlign="center";let i=null;i||(i=document.createElement("style"),i.type="text/css",document.head.appendChild(i)),i.sheet.insertRule("\n    @keyframes spin { \n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ",i.length);const o=document.createElement("div");o.id="loader",o.style.border="5px solid rgba(220,220,223,0.5)",o.style.borderTop="5px solid rgba(255,255,255,0.3)",o.style.borderRadius="50%",o.style.width="30px",o.style.height="30px",o.style.animation="spin 1s linear infinite",document.body.appendChild(t),t.appendChild(o),t.appendChild(e)}(),nt.log("Autofill Started",{host:t.host,uid:e.uid})})),states:{[Rn]:{type:"final",entry:({advertiser:t,shopper:e},n)=>kn(this,void 0,void 0,(function*(){En(),yield nt.log("Autofill Cancelled",{host:t.host,section:null==n?void 0:n.data.section,uid:e.uid})}))},[On]:{type:"final",entry:({advertiser:t,shopper:e})=>kn(this,void 0,void 0,(function*(){setTimeout((()=>{En()}),4e3),yield Promise.allSettled([nt.log("Autofill Finished",{host:t.host,uid:e.uid}),E.set(u,{state:On})])}))},[Nn]:{type:"final",exit:({advertiser:t,shopper:e})=>kn(this,void 0,void 0,(function*(){En(),yield Promise.allSettled([nt.log("Autofill Failed",{host:t.host,uid:e.uid}),E.set(u,{state:Nn})])}))},[In]:{entry:({advertiser:t,shopper:e})=>kn(this,void 0,void 0,(function*(){En(),yield Promise.allSettled([nt.log("Autofill Filled",{host:t.host,uid:e.uid}),E.set(u,{state:In})])})),on:{CANCEL:Rn,CONFIRM:"autofill"}},autofill:{invoke:{id:"autofill",src:({sequence:t,shopper:e,index:n})=>kn(this,void 0,void 0,(function*(){return yield function(t,e){var n;return wn(this,void 0,void 0,(function*(){const{selector:i,action:o,value:r,options:a=bn}=t,{waitBefore:s=0,waitAfter:c=0,optional:l=!1,timeout:u=5e3,completeIfPresent:d=!0,waitValue:h=!1,attributes:f=!1}=a,p="string"==typeof i?i:i(e);let v,y;r&&(v="string"==typeof r?function(t,e,n="."){return(Array.isArray(e)?e:e.split(n)).reduce(((t,e)=>null==t?void 0:t[e]),t)}(e,r):r(e));try{y=yield function(t,{timeOut:e=5e3,completeIfPresent:n=!0,attributes:i=!1}={timeOut:5e3,completeIfPresent:!0,attributes:!1}){return wn(this,void 0,void 0,(function*(){return new Promise(((o,r)=>{const a="selector"===xn(t)?document.querySelector(t):document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(a&&n)return void o(a);const s=new MutationObserver(((e,n)=>{for(const r of e){if("childList"===r.type)for(const e of r.addedNodes)try{const i="selector"===xn(t)?e.querySelector(t):document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=i?i:e.matches(t))return o(null!=i?i:e),void n.disconnect()}catch(t){console.error(t)}if("attributes"===r.type&&i)try{const e="selector"===xn(t)?r.target.querySelector(t):document.evaluate(t,r.target,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=e?e:r.target.matches(t))return o(null!=e?e:r.target),void n.disconnect()}catch(t){console.error(t)}}}));s.observe(document.body,{childList:!0,subtree:!0,attributes:i}),setTimeout((()=>{s.disconnect(),r(new gn(`Element ${t} not found within ${e}ms`))}),e)}))}))}(p,{timeOut:u,completeIfPresent:d,attributes:f}),yield Sn(s),"string"==typeof o?yield mn[o](y,v):yield o(y,v),h&&_n(y,null!==(n=v)&&void 0!==n?n:""),yield Sn(c)}catch(t){if(!(t instanceof gn&&l))throw t}}))}(t[n],e)})),onDone:[{cond:({sequence:t,index:e})=>e===t.length-1,target:On},{cond:({sequence:t,index:e})=>e===t.length-2,target:In,actions:vn({index:({index:t})=>t+1})},{target:"autofill",actions:vn({index:({index:t})=>t+1})}],onError:{target:Nn,actions:console.error}},on:{CANCEL:{target:Rn,actions:An("autofill")}},after:{8e3:{target:Nn}}}}},Mt||"predictableActionArguments"in i||pn||(pn=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new fn(i,undefined);var i}const Tn="READY",Pn="PURCHASING - AUTOFILLING",In="FILLED",On="CONFIRMED",Nn="FAILED",Rn="CANCELLED",Ln={primary:{default:"#FB8500",_dark:"#FB8500"},primaryHover:{default:"#fcaa4d",_dark:"#fcaa4d"},primarySurface:{default:"#ffebd6",_dark:"#7e4300"},secondary:{default:"#00b491",_dark:"#4dcbb2"},secondaryHover:{default:"#4dcbb2",_dark:"#00755F"},secondarySurface:{default:"#e8f5e4",_dark:"#00755F"},surface:{default:"#FFFFFF",_dark:"#121212"},surfaceVariant:{default:"#F7F5F6",_dark:"#292929"},surfaceTertiary:{default:"#ededed",_dark:"#3d3d3d"},onSurface:{default:"#242526",_dark:"#FFFFFF"},onSurfaceVariant:{default:"#646567",_dark:"#B2B3B3"},blueAccent:{default:"#34afcc",_dark:"#34afcc"},blueAccentSurface:{default:"#e8f1fa",_dark:"#22788C"},error:{default:"#FF6A6A",_dark:"#FF6A6A"},delete:{default:"#F07B72",_dark:"#F07B72"},approved:{default:"#e8f5e4",_dark:"#00755F"},pending:{default:"#ffebd6",_dark:"#7e4300"},declined:{default:"#FFD8D8",_dark:"#FF6A6A"},yellowAccent:"#FBEB7A",yellowAccentSurface:"#fff8dc",progressBar:{100:"#fdb666",200:"#fcaa4d",300:"#fc9d33",400:"#fb9119",500:"#FB8500",600:"#e27800",700:"#c96a00",800:"#b05d00",900:"#975000"}};var Dn,Mn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class Bn{constructor(t,e,n,i,o,r,a,s,c,l,u,d){this.id=t,this.created_at=e,this.qoins=n,this.is_transactor=i,this.inactive_cashback_user=o,this.really_inactive_user=r,this.qoala_code=a,this.country=s,this.trees_amount=c,this.is_enterprise=l,this.power_user=u,this.cashback_multiplier=d}static get(t){return Mn(this,void 0,void 0,(function*(){const e=["@USER_KEY",t];return H.fetch(e,(()=>Mn(this,void 0,void 0,(function*(){const e=yield Q.refreshToken();return yield z.fetch(`${R}users/${t}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})}))),3e4)}))}static getFollowing(t){return Mn(this,void 0,void 0,(function*(){const e=yield Q.refreshToken(),n=yield z.fetch(`${R}users/${t}/following`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!n.success)throw new Error("Error getting following.");return n.data}))}static addFollowing(t,e){return Mn(this,void 0,void 0,(function*(){const n=yield Q.refreshToken(),i=yield z.fetch(`${R}users/${t}/following`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({host:e.host,advertiser_name:e.advertiser_name})});if(!i.success)throw new Error("Error getting following.");return i.data}))}static removeFollowing(t,e){return Mn(this,void 0,void 0,(function*(){const n=yield Q.refreshToken(),i=yield z.fetch(`${R}users/${t}/following/${e.host}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!i.success)throw new Error("Error getting following.");return i.data}))}static getAllTransactions(t,e,n=0,i,o,r){return Mn(this,void 0,void 0,(function*(){const a=yield Q.refreshToken(),s=yield z.fetch(`${R}users/${t}/transactions?offset=${n}&limit=${e}${i?"&type="+i:""}${o?`&status=${o}`:""}${r?`&exclude=${r}`:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!s.success)throw new Error("Error getting user.");return s.data}))}}!function(t){t.TRENDING="Trending",t.CASHBACK="Cashback",t.BIG_POPPA="Big Poppa",t.NON_TRANSACTOR_CASHBACK="Non Transactor Cashback",t.TOGGLE_CASHBACK="Toggle Cashback",t.STORE_DETAIL="Store Detail",t.SEARCH="Search",t.SEARCH_TAG="Search Tag",t.PEER_POPUP="Peer Popup",t.COUPON_TESTER_POPUP="Coupon Tester Popup"}(Dn||(Dn={}));var $n=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class jn{static get(){var t;return $n(this,void 0,void 0,(function*(){return null!==(t=yield H.fetch(["@WHITELIST_KEY"],(()=>$n(this,void 0,void 0,(function*(){var t;const e=yield z.fetch(`${R}v4/advertisers/whitelist`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e)throw new Error("Error getting whitelist.");const n=e;if(!n.data)throw new Error("Error getting whitelist.");return null!==(t=n.data.whitelist)&&void 0!==t?t:[]}))),216e5))&&void 0!==t?t:[]}))}}var Fn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class Un{constructor(t,e,n,i,o,r,a,s,c,l,u){this.uid=t,this.email=e,this.billingInfo=n,this.cardInformation=i,this.firstName=o,this.lastName=r,this.phoneNumber=a,this.countryNumberCode=s,this.shippingAddresses=c,this.gender=l,this.nif=u}static query(t){return Fn(this,void 0,void 0,(function*(){const e=yield Q.refreshToken(),n=new URL(`${L}/shoppers/${t}`),i=yield z.fetch(n.toString(),{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(null!==i){if(i.error)throw new Error("Error getting shopper.");return i.data}}))}static createOrUpdate(t,e){return Fn(this,void 0,void 0,(function*(){const n=new URL(`${L}/shoppers/${t}`),i=yield Q.refreshToken();return yield z.fetch(n.toString(),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(e)})}))}}var qn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};function Vn(t,{timeOut:e=5e3,completeIfPresent:n=!0,attributes:i=!1}={timeOut:5e3,completeIfPresent:!0,attributes:!1}){return qn(this,void 0,void 0,(function*(){return yield new Promise((o=>{const r="selector"===zn(t)?document.querySelector(t):document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(r&&n)return void o(r);const a=new MutationObserver(((e,n)=>{for(const r of e){if("childList"===r.type)for(const e of r.addedNodes)try{const i="selector"===zn(t)?e.querySelector(t):document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=i?i:e.matches(t))return o(null!=i?i:e),void n.disconnect()}catch(t){console.error(t)}if("attributes"===r.type&&i)try{const e="selector"===zn(t)?r.target.querySelector(t):document.evaluate(t,r.target,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=e?e:r.target.matches(t))return o(null!=e?e:r.target),void n.disconnect()}catch(t){console.error(t)}}}));a.observe(document.body,{childList:!0,subtree:!0,attributes:i}),setTimeout((()=>{a.disconnect(),o("Element Not Found")}),e)}))}))}function zn(t){return/^\/\//.test(t)?"xpath":"selector"}function Gn(t){return t.replace(/[^0-9,\.]/g,"")}function Hn(t,e){return n=this,i=void 0,r=function*(){if(t.value=e,!t.dispatchEvent(new Event("change",{bubbles:!0})))throw new Error(`Could not set value ${e} on node ${t}`)},new((o=void 0)||(o=Promise))((function(t,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function s(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}const Yn={click:function(t){return e=this,n=void 0,o=function*(){if(!t.dispatchEvent(new MouseEvent("click",{bubbles:!0})))throw new Error(`Could not click on node ${t}`)},new((i=void 0)||(i=Promise))((function(t,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}));var e,n,i,o},select:function(t,e,n=((t,e)=>t.innerHTML.includes(e))){return i=this,o=void 0,a=function*(){const i=t.options;for(let o=0;o<i.length;o++)if(n(i[o],e))return Hn(t,i[o].value);throw new Error(`Could not set value ${e} on select ${t}`)},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a},type:function(t,e,n=50){return i=this,o=void 0,a=function*(){t.focus();for(const i of e){const e=new KeyboardEvent("keydown",{key:i,bubbles:!0}),o=new InputEvent("input",{data:i,bubbles:!0}),r=new KeyboardEvent("keyup",{key:i,bubbles:!0});t.value+=i,t.dispatchEvent(e),t.dispatchEvent(o),t.dispatchEvent(r),yield new Promise((t=>setTimeout(t,n)))}const i=new Event("change",{bubbles:!0});t.dispatchEvent(i)},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a},write:Hn,waitForValue:function(t,e,n=4e3){return i=this,o=void 0,a=function*(){return new Promise(((i,o)=>{t.value===e&&i();const r=new MutationObserver((function(t){t.forEach((function(t){t.target instanceof HTMLInputElement&&"attributes"===t.type&&"value"===t.attributeName&&t.target.value===e&&(r.disconnect(),i())}))}));r.observe(t,{attributes:!0,attributeFilter:["value"]}),setTimeout((()=>{r.disconnect(),o(new Error(`Element ${t.id} not filled with value ${e} within ${n}ms`))}),n)}))},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a}};var Kn=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const Jn="READY",Xn="TESTING",Wn="TEST_FINISHED",Qn="TEST_FINISHED_FAILED",Zn="FAILED",ti="Real ACT",ei="Fake ACT",ni="Sleek ACT",ii={tiendanimal:{entrypoint:'div.desk-view input[id="couponCode"]',ACTConfig:{coupon_input:'div.desk-view input[id="couponCode"]',submit_input:"div.desk-view button.promo-code-btn",error_selector:"div.desk-view span.coupon-error-message",success_selector:"div.desk-view div.coupons-and-promos section.is-success",original_price_selector:"div.desk-view p.grand-total",discount_price_selector:"div.desk-view p.grand-total",prices_use_comma:!1,is_simple:!0,remove_coupon_selector:"div.desk-view button.remove-coupon.coupon-alert-valid"}}};var oi=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class ri{constructor(t,e){this.host=t,this.exp=e}static set(t){return oi(this,void 0,void 0,(function*(){return yield E.set(h,{host:t,exp:Date.now()+9e5})}))}static get(){return oi(this,void 0,void 0,(function*(){return yield E.get(h)}))}static wasActivated(t){return oi(this,void 0,void 0,(function*(){const e=yield E.get(h);return!!e&&e.host===t&&e.exp>Date.now()}))}}var ai=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},si=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};class ci{constructor(t,e){this.host=t,this.exp=e}static set(t){return si(this,void 0,void 0,(function*(){return yield E.set(f,{host:t,exp:Date.now()+6e5})}))}static get(){return si(this,void 0,void 0,(function*(){return yield E.get(f)}))}static wasCouponPageDetected(t){return si(this,void 0,void 0,(function*(){const e=yield E.get(f);return!!e&&e.host===t&&e.exp>Date.now()}))}}var li=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};const ui="qla-qoala-cashback-container",di="qla-qoala-tab-widget-container",hi="qla-qoala-checkout-container",fi="qla-qoala-success-container",pi="qla-qoala-redirect-container",vi="qla-qoala-peer-container",yi="qla-qoala-autofill-container",mi="qla-qoala-act-container",gi=64,wi=new class{constructor(){}createMachine(t,e,n){var o;if(Object.keys(ct).includes(e.host)){const r=null!=n?n:null===(o=ct[e.host].entrypoints.find((({selector:t})=>null!==document.querySelector(t))))||void 0===o?void 0:o.selector,a=Cn(sn[e.host].slice(sn[e.host].findIndex((({selector:e})=>"string"==typeof e?e===r:e(t)===r))),t,e);this.machine=rn(a,{devTools:!0});const s=this;return i.get().storage.onChanged.addListener((function(t,e){for(const e in t)if(e===u){const n=t[e];n.newValue.state===Rn&&s.machine.send({type:"CANCEL",data:{advertiser:n.newValue.data.advertiser,section:n.newValue.data.section}}),n.newValue.state===On&&s.machine.send({type:"CONFIRM"})}})),this.machine}throw new Error("Cannot autofill because no host / seller was provided")}getMachine(){if(!this.machine)throw Error("Machine isn't created yet.");return this.machine}},bi=new class{constructor(){}start(t,e){return Kn(this,void 0,void 0,(function*(){console.log("Start Coupon Tester...");try{const e=document.querySelector(t.original_price_selector),n=null==e?void 0:e.innerHTML.replace("","").trim();if(n){let e=Gn(n);t.prices_use_comma&&(e=e.replace(/\./g,""),e=e.replace(/\,/g,".")),yield E.set(y,e),yield Vn(t.coupon_input)}}catch(t){yield nt.log(P,{host:e.host,error:t})}}))}saveDiscount(t,e,n,i){return Kn(this,void 0,void 0,(function*(){try{const o=document.querySelector(e.discount_price_selector);if(o){let r=Gn(o.innerHTML.replace("","").trim());e.prices_use_comma&&(r=r.replace(/\./g,""),r=r.replace(/\,/g,"."));const a=yield E.get(w);if(a){const t=JSON.parse(a);t.push({coupon:n[i].code,price:parseFloat(r)}),yield E.set(w,JSON.stringify(t))}else yield E.set(w,JSON.stringify([{coupon:n[i].code,price:parseFloat(r)}]));const s=i+1;yield E.set(v,s),window.parent.postMessage({id:U,payload:{coupons:n,advertiser:t}},"*")}}catch(e){yield nt.log(P,{host:t.host,error:e})}}))}testCoupon(t,e,n,i){return Kn(this,void 0,void 0,(function*(){if(void 0!==e)try{yield E.set(d,{state:Xn,host:t.host,type:ti}),0===i&&(yield this.start(e,t)),"Element Not Found"!==(yield Vn(e.success_selector,{timeOut:1500}))&&(yield this.removeCoupon(e,t)),yield E.set(v,i);const o=n.length>10?10:n.length;if(i+1>o){const i=yield this.compareDiscounts(t);return i?void(yield this.applyBestDiscount(e,t,n,i)):void 0===i?(yield E.set(d,{state:Qn,host:t.host,type:ti}),void(yield rt.openTrackingUrl(t.tracking_url,{host:t.host,network:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:Dn.COUPON_TESTER_POPUP,category:t.category,type:O},!1,!0).then().catch((()=>{console.log("Error opening the Link URL")})))):void 0}const r=document.querySelector(e.coupon_input);r.value="",yield Yn.write(r,"");const a=document.querySelector(e.submit_input);if(yield Yn.write(r,n[i].code),yield Yn.click(a),"Element Not Found"!==(yield Vn(e.success_selector,{timeOut:1800})))yield this.saveDiscount(t,e,n,i);else{const o=i+1;yield E.set(v,o),yield this.removeCoupon(e,t),window.parent.postMessage({id:U,payload:{coupons:n,advertiser:t}},"*")}}catch(e){console.log(e),yield nt.log(P,{host:t.host,error:e}),yield E.set(d,{state:Zn,host:t.host,type:ti})}}))}removeCoupon(t,e){return Kn(this,void 0,void 0,(function*(){try{if(t.remove_coupon_selector){const e=yield Vn(t.remove_coupon_selector,{timeOut:1e3});e&&"Element Not Found"!==e&&(yield Yn.click(e),yield function(t){return qn(this,void 0,void 0,(function*(){yield new Promise((e=>{if(!document.querySelector(t))return e(),!0;const n=new MutationObserver((i=>{for(const o of i)"childList"!==o.type||document.querySelector(t)||(n.disconnect(),e())}));n.observe(document.body,{childList:!0,subtree:!0})}))}))}(t.success_selector))}}catch(t){console.log(t),yield nt.log(P,{host:e.host,error:t}),yield E.set(d,{state:Zn,host:e.host,type:ti})}}))}compareDiscounts(t){return Kn(this,void 0,void 0,(function*(){try{const t=yield E.get(w);if(t){const e=JSON.parse(t),n=e.reduce(((t,e)=>e.price<t.price?e:t),e[0]);return yield E.set(m,n.price),yield E.set(g,n.coupon),n}}catch(e){console.log(e),yield nt.log(P,{host:t.host,error:e})}}))}applyBestDiscount(t,e,n,i){return Kn(this,void 0,void 0,(function*(){try{const n=yield Vn(t.coupon_input),o=document.querySelector(t.submit_input);n||o||(console.log("Inputs were not found..."),yield E.set(d,{state:Zn,host:e.host,type:ti})),n.value="",yield Yn.write(n,i.coupon),yield Yn.click(o),yield E.set(d,{state:Wn,host:e.host,type:ti})}catch(t){console.log(t),yield nt.log(P,{host:e.host,error:t}),yield E.set(d,{state:Zn,host:e.host,type:ti})}}))}startSleekACT(t,e){return Kn(this,void 0,void 0,(function*(){console.log("Start Sleek Coupon Tester...");try{yield E.set(d,{state:Xn,host:t.host,type:ni})}catch(e){console.log(e),yield nt.log(P,{host:t.host,error:e}),yield E.set(d,{state:Zn,host:t.host,type:ni})}}))}};function _i(t,e,n){return li(this,void 0,void 0,(function*(){const o=document.createElement("iframe");o.id=ui,o.style.all="unset",o.style.position="fixed",o.style.top=n?`${n}px`:"0",o.style.right="0",o.style.width="400px",o.style.height="450px",o.style.margin="16px",o.style.borderRadius="8px",o.style.zIndex="2147483647",o.style.background="none transparent",o.style.backgroundColor="none transparent",o.src=i.get().runtime.getURL(`content-scripts/store/cashbackPopup/CashbackPopup.html?hostname=${t}&context=${e}`),document.getElementById(ui)||document.body.appendChild(o)}))}function xi(t,e){const n=document.createElement("iframe");n.id=yi,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="360px",n.style.height="1000px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=i.get().runtime.getURL(`content-scripts/store/autofillPopup/AutofillPopup.html?host=${t.host}&shopperUid=${e}`),document.getElementById(yi)||document.body.appendChild(n)}function Ei(t){const e=document.createElement("iframe");e.id=mi,e.style.all="unset",e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.width="380px",e.style.height="1000px",e.style.margin="16px",e.style.borderRadius="8px",e.style.zIndex="2147483647",e.style.background="none transparent",e.style.backgroundColor="none transparent",e.src=i.get().runtime.getURL(`content-scripts/store/actPopup/ACTPopup.html?host=${t.host}`),document.getElementById(mi)||document.body.appendChild(e)}function Si(t){return li(this,void 0,void 0,(function*(){yield E.set(d,{state:Qn,host:t.host,type:ni});const e=yield Q.get();e&&(yield nt.log(P,{host:t.host,uid:e.uid,type:ni})),yield rt.openTrackingUrl(t.tracking_url,{host:t.host,network:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:Dn.COUPON_TESTER_POPUP,category:t.category,type:O},!1,!0)}))}function ki(){return li(this,void 0,void 0,(function*(){yield E.remove(g),yield E.remove(m),yield E.remove(v),yield E.remove(w),yield E.remove(y)}))}function Ai(t){return li(this,void 0,void 0,(function*(){const e=window.location.hostname;if((yield E.get(x))||(yield function(t){return li(this,void 0,void 0,(function*(){const e=document.createElement("div");let n=yield E.get(b);n||(n=window.innerHeight/3,yield E.set(b,n));const o=yield et.isActive(t.host);e.id=di,e.style.all="unset",e.style.position="fixed",e.style.width="104px",e.style.height=`${gi}px`,e.style.right="0px",e.style.boxShadow="0px 0px 16px #00000038",e.style.borderTopLeftRadius="8px",e.style.borderBottomLeftRadius="8px",e.style.top=`${n}px`,e.style.zIndex="2147483647",e.style.transform="translate(24px)",e.style.backgroundColor=Ln.primaryHover.default,e.addEventListener("mouseenter",(()=>{const t=document.getElementById(di);t&&"translate(0px)"!==t.style.transform&&(t.style.transform="translate(0px)")})),e.addEventListener("mouseleave",(()=>{const t=document.getElementById(di);t&&"translate(24px)"!==t.style.transform&&(t.style.transform="translate(24px)")}));const r=document.createElement("div");r.id=di+"header",r.style.height="100%",r.style.width="24px",r.style.cursor="grab",r.style.display="flex",r.style.position="absolute",r.style.right="0",r.style.boxShadow="rgb(79 79 79) 4px 0px 4px inset",r.style.backgroundColor="rgb(103 103 103)";const a=document.createElement("img");a.style.width="14px",a.style.height="14px",a.style.alignSelf="center",a.style.margin="auto",a.src=i.get().runtime.getURL("assets/images/drag_icon.svg"),r.appendChild(a);const s=document.createElement("div");s.id=di+"clickable",s.style.height="100%",s.style.width="80px",s.style.cursor="pointer",s.style.display="flex",s.style.borderTopLeftRadius="8px",s.style.borderBottomLeftRadius="8px",s.style.position="absolute",s.style.left="0",s.style.background=o?Ln.secondary.default:"linear-gradient(90deg, rgba(251,133,0,1) 0%, rgba(252,170,77,1) 100%)";const c=document.createElement("img");c.id=di+"image",c.style.width="46px",c.style.height="46px",c.style.alignSelf="center",c.style.margin="auto",c.src=i.get().runtime.getURL("assets/images/iconwhite128.png"),s.appendChild(c),e.appendChild(s),e.appendChild(r),document.getElementById(di)||document.body.appendChild(e);const l=document.getElementById(di);l&&function(t){let e=0,n=0;const i=document.getElementById(t.id+"image");i&&(i.onmouseenter=s,i.onmouseleave=function(){const t=document.getElementById(ui);null==t||t.addEventListener("mouseover",(()=>{clearTimeout(e)})),null==t||t.addEventListener("mouseleave",(()=>{setTimeout((()=>{window.parent.postMessage({id:F},"*")}),500),t.removeEventListener("mouseover",(()=>{})),t.removeEventListener("mouseleave",(()=>{}))}));const e=setTimeout((()=>{window.parent.postMessage({id:F},"*")}),500)});const o=document.getElementById(t.id+"header");function r(t){var e;const o=t;o.preventDefault(),document.getElementById(ui)&&(null===(e=document.getElementById(ui))||void 0===e||e.remove()),n=o.clientY,document.onmouseup=c,document.onmousemove=a,i&&(i.onmouseenter=null)}function a(i){const o=i;o.preventDefault(),e=n-o.clientY,n=o.clientY;const r=t.offsetTop-e;r>=0&&r<window.innerHeight-gi&&(t.style.top=`${r}px`)}function s(){var t;return li(this,void 0,void 0,(function*(){const e=null!==(t=yield E.get(b))&&void 0!==t?t:0;_i(window.location.hostname,Dn.TOGGLE_CASHBACK,(null!=e?e:0)+gi)}))}function c(){o&&(o.style.backgroundColor="rgb(103 103 103)"),i&&(i.onmouseenter=s),document.onmouseup=null,document.onmousemove=null,E.set(b,t.offsetTop-e)}o?o.onmousedown=r:t.onmousedown=r}(l)}))}(t)),yield E.get(_))return yield function(t,e){return li(this,void 0,void 0,(function*(){const e=document.createElement("iframe");e.id=fi,e.style.all="unset",e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.width="330px",e.style.height="360px",e.style.margin="16px",e.style.borderRadius="8px",e.style.zIndex="2147483647",e.style.background="none transparent",e.style.backgroundColor="none transparent",e.src=i.get().runtime.getURL(`content-scripts/store/successPopup/SuccessPopup.html?hostname=${t}`),document.getElementById(fi)||document.body.appendChild(e)}))}(e),void(yield E.set(_,!1));if(!(yield st.isMuted(t.host))){let n;console.log("Cashback available! Displaying popup...");const o=yield Q.get();o&&(n=yield Bn.get(o.uid)),(null==n?void 0:n.really_inactive_user)?yield function(t,e){return li(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=ui,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="1400px",n.style.height="800px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=i.get().runtime.getURL(`content-scripts/store/bigPoppa/BigPoppa.html?hostname=${t}&context=${e}`),document.getElementById(ui)||document.body.appendChild(n)}))}(e,Dn.BIG_POPPA):(null==n?void 0:n.is_transactor)?(null==n?void 0:n.inactive_cashback_user)?yield function(t,e,n){return li(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=ui,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="400px",n.style.height="450px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=i.get().runtime.getURL(`content-scripts/store/cashbackExpirationPopup/CashbackExpirationPopup.html?hostname=${t}&context=${e}`),document.getElementById(ui)||document.body.appendChild(n)}))}(e,Dn.CASHBACK):yield _i(e,Dn.CASHBACK):yield function(t,e,n){return li(this,void 0,void 0,(function*(){const e=document.createElement("iframe");e.id=ui,e.style.all="unset",e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.width="700px",e.style.height="400px",e.style.margin="16px",e.style.borderRadius="8px",e.style.zIndex="2147483647",e.style.background="none transparent",e.style.backgroundColor="none transparent",e.src=i.get().runtime.getURL(`content-scripts/store/nonTransactorCashbackPopup/NonTransactorCashbackPopup.html?hostname=${t}`),document.getElementById(ui)||document.body.appendChild(e)}))}(e),yield st.mute(t.host)}}))}function Ci(){return li(this,void 0,void 0,(function*(){const t=yield jn.get();let e=window.location.hostname;if(console.log(e),"www.computop-paygate.com"===e&&(e="mediamarkt.es"),"sis.redsys.es"===e&&(e="www.primor.eu"),t.includes(e)){console.log(`Finding deals for ${e}...`);const t=yield X.query({hostname:e,active:!0,joined:!0});if(!t)return void(yield V.send(j,{reset:!0}));if(t.hide_platforms.includes("Extension"))return;const n=yield et.isActive(t.host);yield V.send(j,{activeCashback:n});const o=yield ri.wasActivated(t.host),r=yield ci.wasCouponPageDetected(t.host);n||o||!t.tracking_url||!t.checkout_url_keyword&&!r||!window.location.href.includes(t.checkout_url_keyword)&&!r||(yield function(t){return li(this,void 0,void 0,(function*(){console.log("Landed in Checkout page..."),function(t){var e,n;li(this,void 0,void 0,(function*(){if(!(yield Q.get()))return;if(!(null===(e=t.coupon_tester)||void 0===e?void 0:e.enabled))return;const i=yield ri.wasActivated(t.host),o=yield E.get(d);(null===(n=t.coupon_tester)||void 0===n?void 0:n.engine)===D.SLEEK?yield function(t,e,n){return li(this,void 0,void 0,(function*(){if((null==n?void 0:n.state)===Xn&&!e){const e=yield E.get(p);Ei(t),window.parent.postMessage({id:q,payload:{coupons:e,advertiser:t}},"*")}(null==n?void 0:n.state)===Xn||e||(yield ki(),yield E.set(d,{state:Jn,host:t.host,type:ni})),Ei(t)}))}(t,i,o):yield function(t,e,n){return li(this,void 0,void 0,(function*(){if((null==n?void 0:n.state)===Xn&&!e){const e=yield E.get(p);Ei(t),window.parent.postMessage({id:U,payload:{coupons:e,advertiser:t}},"*")}if((null==n?void 0:n.state)===Wn&&(null==n?void 0:n.host)===t.host&&!e)return rt.openTrackingUrl(t.tracking_url,{host:t.host,network:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:Dn.COUPON_TESTER_POPUP,category:t.category,type:O},!1,!0).then().catch((()=>{console.log("Error opening the Link URL")})),void Ei(t);const i=new MutationObserver(((n,i)=>li(this,void 0,void 0,(function*(){var n;if(null===(n=ii[t.host])||void 0===n?void 0:n.entrypoint){const n=yield E.get(d);(null==n?void 0:n.state)===Xn||e||(yield ki(),yield E.set(d,{state:Jn,host:t.host,type:ti}))}else yield E.set(d,{state:Jn,host:t.host,type:ei});Ei(t),i.disconnect()}))));i.observe(document.documentElement,{attributes:!1,childList:!0,subtree:!0})}))}(t,i,o)}))}(t)}))}(t)),t.cashback.active&&t.tracking_url&&(yield function(t){var e;return li(this,void 0,void 0,(function*(){(null===(e=t.autofill)||void 0===e?void 0:e.enabled)&&(yield function(t){var e,n;return li(this,void 0,void 0,(function*(){const i=yield Q.get();if(!i)return;if(!(yield Un.query(i.uid)))return;const o=yield E.get(u);if((null==o?void 0:o.state)===Pn)xi(t,i.uid);else if((null==o?void 0:o.state)===In)xi(t,i.uid);else{const o=new MutationObserver(((e,n)=>{const o=ct[t.host].entrypoints.find((({selector:t})=>null!==document.querySelector(t)));o&&(E.set(u,{state:Tn,data:{selector:o.selector,required_fields:o.required_fields}}),xi(t,i.uid),n.disconnect())})),r={attributes:null!==(n=null===(e=ct[t.host].options)||void 0===e?void 0:e.attributes)&&void 0!==n&&n,childList:!0,subtree:!0};o.observe(document.documentElement,r)}}))}(t)),t.success_url_keyword&&window.location.href.includes(t.success_url_keyword)?yield function(t){return li(this,void 0,void 0,(function*(){console.log("Landed in Confirmation page...");const e=yield Q.get(),n=yield et.isActive(t.host);if(e&&n){const e=yield N.getSessionId(),n=yield et.get();n&&(yield Z.send(n.clickId,e,t)),nt.log(T,{page_name:I,page_data:{host:t.host,category:t.category,advertiser_id:t.advertiser_id,network:t.network}})}}))}(t):t.hide_extension_popups||(yield Ai(t))}))}(t)),t.peer_keywords&&(yield function(t){return li(this,void 0,void 0,(function*(){const e=window.location.href,n=t.peer_keywords.find((t=>t.keywords.find((t=>e.includes(t)))));n&&!t.hide_extension_popups&&((yield st.isMuted(t.host))||function(t,e){li(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=vi,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="350px",n.style.height="460px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=i.get().runtime.getURL(`content-scripts/store/peerPopup/PeerPopup.html?hostname=${e}&title=${t.title}&offer_id=${t.offer_id}`),document.getElementById(vi)||document.body.appendChild(n)}))}(n,window.location.hostname),yield st.mute(t.host))}))}(t))}}))}(new class{constructor(){this.endpoint="https://api.heisen.eu/shopping-intent/event",this.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U"}buildRequest(t){return ai(this,void 0,void 0,(function*(){const e=yield Q.get(),n=(null==e?void 0:e.uid)?null==e?void 0:e.uid:"";t=Object.assign(Object.assign({},t),{url:window.location.toString(),uid:n}),fetch(this.endpoint,{mode:"no-cors",headers:{Authorization:"Bearer "+this.token,Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)})}))}sendProdutVisitEvent(){return ai(this,void 0,void 0,(function*(){const t=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/";["https://www.miravia.es/p/"].includes(t)&&(console.log("sendProdutVisitEvent"),this.buildRequest({type:"PRODUCT_VISIT"}))}))}sendMiraviaPlaceOrderEvent(){return ai(this,void 0,void 0,(function*(){const t=new URLSearchParams(window.location.search).get("checkoutOrderId");if(t){console.log("sendMiraviaPlaceOrderEvent");const e={type:"ORDER_REFERENCE",order_reference:t};this.buildRequest(e)}}))}sendEvent(){return ai(this,void 0,void 0,(function*(){this.sendProdutVisitEvent(),this.sendMiraviaPlaceOrderEvent()}))}}).sendEvent(),window.addEventListener("message",(function(t){var e,n,o,r,a,s,c,l,d,h,f;switch(t.data.id){case"@CASHBACK_POPUP_HIDE_MESSAGE":const p=document.getElementById(ui);p&&(p.style.visibility="hidden");break;case F:null===(e=document.getElementById(ui))||void 0===e||e.remove(),null===(n=document.getElementById(ui))||void 0===n||n.remove();break;case"@CHECKOUT_POPUP_CLOSE_MESSAGE":null===(o=document.getElementById(hi))||void 0===o||o.remove();break;case"@SUCCESS_POPUP_CLOSE_MESSAGE":null===(r=document.getElementById(fi))||void 0===r||r.remove();break;case"@REDIRECT_POPUP_OPEN_MESSAGE":(function(t){return li(this,void 0,void 0,(function*(){const e=document.createElement("iframe");e.id=pi,e.style.all="unset",e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="2147483647",e.style.background="none transparent",e.style.backgroundColor="none transparent",e.src=i.get().runtime.getURL(`content-scripts/store/redirectPopup/RedirectPopup.html?hostname=${t}`),document.getElementById(pi)||document.body.appendChild(e)}))})(window.location.hostname).then().catch();break;case"@PEER_POPUP_CLOSE_MESSAGE":null===(a=document.getElementById(vi))||void 0===a||a.remove();break;case"@REDIRECT_POPUP_CLOSE_MESSAGE":null===(s=document.getElementById(pi))||void 0===s||s.remove();break;case"@RECEIPT_CLOSE_MESSAGE":null===(c=document.getElementById("qla-qoala-receipt-container"))||void 0===c||c.remove();break;case"@COUPON_TRIAL_POPUP_CLOSE_MESSAGE":null===(l=document.getElementById("qla-qoala-coupontrial-container"))||void 0===l||l.remove();break;case"@COUPON_TRIAL_POPUP_OPEN_MESSAGE":null===(d=document.getElementById(hi))||void 0===d||d.remove();break;case"@AUTOFILL_POPUP_CLOSE_MESSAGE":E.set(u,{state:Rn,data:t.data.payload}),null===(h=document.getElementById(yi))||void 0===h||h.remove();break;case"@AUTOFILL_START_MESSAGE":{const{shopper:e,advertiser:n,entrypoint:i}=t.data.payload;!function(t,e,n){li(this,void 0,void 0,(function*(){t.cardInformation&&t.shippingAddresses?wi.createMachine(t,e,n).start():console.log("this shopper hasn't  either cardInformation or shippingAddresses")}))}(e,n,i);break}case"@ACT_POPUP_CLOSE_MESSAGE":{const{ACTType:e,advertiser:n}=t.data.payload;e&&nt.log("Coupon Trial Cancelled",{host:n.host,type:e}),null===(f=document.getElementById(mi))||void 0===f||f.remove();break}case U:{const{coupons:e,advertiser:n}=t.data.payload;!function(t,e){li(this,void 0,void 0,(function*(){if(t.length>0){const n=yield E.get(v);n&&0!==n?yield bi.testCoupon(e,ii[e.host].ACTConfig,t,n):yield bi.testCoupon(e,ii[e.host].ACTConfig,t,0)}else console.log("Cannot start ACT...")}))}(e,n);break}case q:{const{coupons:e,advertiser:n}=t.data.payload;!function(t,e){li(this,void 0,void 0,(function*(){t.length>0?yield bi.startSleekACT(e,t):(console.log("Cannot start Sleek ACT because there are no coupons for the Advertiser..."),Si(e))}))}(e,n);break}case"@OPEN_TRACKING_URL_MESSAGE":{const{url:e,data:n,redirect:i,pinned:o}=t.data.payload;(function(t,e,n=!0,i=!1){return li(this,void 0,void 0,(function*(){yield rt.openTrackingUrl(t,{host:e.host,current_url:n?window.location.href:void 0,network:e.network,advertiser_id:e.advertiser_id,advertiser_name:e.advertiser_name,context:e.context,category:e.category,type:e.type,offer_id:e.offer_id},n,i)}))})(e,n,i,o).then().catch();break}}}),!1),i.get().runtime.onMessage.addListener((function(t){var e;switch(t.id){case F:null===(e=document.getElementById(ui))||void 0===e||e.remove();break;case"@ACT_SLEEK_FINISH_MESSAGE":if(t.payload){const{advertiser:e,bestCoupon:n,cartTotalBefore:i,cartTotalAfter:o}=t.payload;(function(t,e,n,i){return li(this,void 0,void 0,(function*(){yield E.set(g,e);const o=n,r=i;if(yield E.set(y,o),yield E.set(m,r),o===r)return void(yield Si(t));yield E.set(d,{state:Wn,host:t.host,type:ni});const a=yield Q.get();yield rt.openTrackingUrl(t.tracking_url,{host:t.host,network:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:Dn.COUPON_TESTER_POPUP,category:t.category,type:O},!1,!0);const s=yield et.get();yield nt.log("Coupon Trial Succeeded",{host:t.host,advertiser_id:t.advertiser_id,network:t.network,click_id:s?s.clickId:"",uid:null==a?void 0:a.uid,type:ni})}))})(e,n,i,o).then().catch()}break;case"@ACT_SLEEK_ERROR_MESSAGE":if(t.payload){const{advertiser:e}=t.payload;Si(e).then().catch()}break;case"@ACT_SLEEK_COUPON_PAGE_DETECTED":{const t=window.location.hostname;X.query({hostname:t,active:!0,joined:!0}).then((t=>{t&&ci.set(t.host).then((()=>{Ci().then().catch()}))}));break}}})),Ci().then().catch()})();